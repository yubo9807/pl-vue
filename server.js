"use strict";var re=Object.defineProperty;var se=(t,e,n)=>e in t?re(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var a=(t,e,n)=>(se(t,typeof e!="symbol"?e+"":e,n),n),bt=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var Rt=(t,e,n)=>(bt(t,e,"read from private field"),n?n.call(t):e.get(t)),wt=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},N=(t,e,n,o)=>(bt(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);const ie=require("http"),Mt=require("fs"),Q=require("path");function it(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function y(t){return["object","array"].includes(it(t))}function ce(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ct(t,e){if(y(t)&&y(e)){const n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;for(const s of n)if(!o.includes(s)||!ct(t[s],e[s]))return!1;return!0}else return t===e}function d(t){return it(t)==="object"}function F(t){return Array.isArray(t)}function z(t){return typeof t=="string"}function _(t){Promise.resolve().then(t)}function ue(){return Number(Math.random().toString().slice(2)).toString(32)}let I=null;const W=new WeakMap;function A(t){I=t,t(),I=null}function le(t){const e=W.get(t)||[],n=e.some(o=>I===o);I&&!n&&(e.push(I),W.set(t,e))}function St(t){const e=W.get(t);e&&e.forEach((n,o)=>{const s=n();typeof s=="boolean"&&s&&(e.splice(o,1),W.set(t,e))})}function It(t){return Reflect.defineProperty(t,E.IS_READONLY,{value:!0}),new Proxy(t,{get(e,n){return n===E.RAW?e:Reflect.get(e,n)},set(e,n,o){return Reflect.get(e,n)},deleteProperty(e,n){return Reflect.get(e,n)}})}function ae(t){return t&&It(t)[E.IS_READONLY]}const Ft=new WeakMap,G=new WeakMap,E={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function b(t){if(!y(t)||Object.isFrozen(t)||Ft.get(t))return t;let e=null;return new Proxy(t,{get(n,o,s){if(o===E.RAW)return n;le(n);const r=Reflect.get(n,o,s);return y(r)?b(r):r},set(n,o,s,r){if(n[E.IS_READONLY])return!0;if(y(n[o])){for(const f in s)this.set(n[o],f,s[f],r[o]);return!0}if(Reflect.get(n,o,r)===s)return!0;const u=Reflect.set(n,o,s,r),l=G.get(n)||new Set;l.add(o);const h=l.size;return G.set(n,l),_(()=>{const f=Reflect.get(n,o,r);u&&f===s&&h===1&&St(n),G.delete(n)}),u},deleteProperty(n,o){Reflect.get(n,o),ce(n,o);const s=Reflect.deleteProperty(n,o);return e=o,_(()=>{o===e&&(St(n),e=null)}),s}})}function ut(t){return!!t[E.RAW]}function fe(t){return ut(t)?t[E.RAW]:t}function he(t){return ut(t)||ae(t)}function pe(t){return y(t)&&Ft.set(t,!0),t}function Lt(t){const e=b({value:t});function n(){return e.value}function o(s){e.value=s}return[n,o]}const lt="__v_isRef";var an;class Vt{constructor(e){a(this,an,!0);a(this,"__v_isShallow",!1);a(this,"_rawValue");a(this,"_value");a(this,"getSignal");a(this,"setSignal");this._rawValue=e;const[n,o]=Lt(e);this.getSignal=n,this.setSignal=o,this._value=n()}get value(){return this.getSignal()}set value(e){this.setSignal(e),this._rawValue=e}}an=lt;function X(t){return new Vt(t)}function Bt(t){return t&&!!t[lt]}function de(t){return Bt(t)?t.value:t}class $t{constructor(e,n,o=void 0){a(this,"__v_isRef",!0);a(this,"_defaultValue");a(this,"_key");a(this,"_object");this._defaultValue=o,this._key=n,this._object=e}get value(){return this._object[this._key]}set value(e){this._object[this._key]=e}}function ge(t,e,n=void 0){return new $t(t,e,n)}function me(t){const e={};for(const n in t)e[n]=new $t(t,n);return e}class ye extends Vt{constructor(n){let o=!1;const{get:s,set:r}=n(()=>o=!0,()=>this.setValue());super(s());a(this,"_get");a(this,"_set");this.__v_isRef=o,this._get=s,this._set=r}get value(){return this.__v_isRef?super.value:this._get()}set value(n){this._set(n)}setValue(){super.value=this._get()}}function _e(t){return new ye(t)}class be{constructor(e){a(this,"fn");this.fn=e}}var fn;class Et{constructor(e,n){a(this,"__v_isReadonly",!0);a(this,fn,!0);a(this,"_cacheable",!0);a(this,"_dirty",!0);a(this,"computed");a(this,"_setter");this.computed=new be(e),this._setter=n}get value(){return this.computed.fn()}set value(e){this._setter&&this._setter(e)}}fn=lt;function Ut(t){return typeof t=="function"?new Et(t):new Et(t.get,t.set)}const S=function(){const t=new WeakMap,e=["null","weakset","weakmap"],n={set(o){const s=new Set;for(const r of o)s.add(S(r));return s},map(o){const s=new Map;for(const[r,i]of o.entries())s.set(r,S(i));return s}};return function(o){const s=it(o);if(typeof o!="object"||e.includes(s))return o;if(t.has(o))return t.get(o);if(n[s])return n[s](o);const r=F(o)?[]:{};Object.setPrototypeOf(r,Object.getPrototypeOf(o)),t.set(o,r);for(const i in o)r[i]=S(o[i]);return r}}();function P(t,e){return Object.assign({},t,e)}function K(t,e,n={}){let o=!1;if(o)return;const s=t();let r=S(s);return n.immediate&&e(s,void 0),A(()=>{const i=[];if(o)return i.length>0&&i.forEach(l=>l()),!0;const u=t();y(s)?n.deep&&!ct(u,r)&&(e(u,b(r)),r=S(u),Wt(u).forEach(l=>{const h=K(()=>l,()=>{e(u,b(r))},{deep:!0});i.push(h)})):u!==r&&(e(u,r),r=S(u))}),()=>{o=!0}}function Wt(t,e=[]){for(const n in t)y(t[n])&&(e.push(t[n]),Wt(t[n],e));return e}function Re(t){let e=!1,n=!1;return A(()=>{if(e)return!0;t(o=>{n&&o(),n=!0})}),()=>{e=!0}}function T(t){return["string","number"].includes(typeof t)&&t!==""}function Dt(t){return!/^on/.test(t)}function at(t){return d(t)&&(z(t.tag)||M(t.tag))}function p(t){return typeof t=="function"&&!M(t)}function ft(t){return[void 0,null,"",!0,!1].includes(t)}function L(t){return document.createTextNode(t)}function c(t,e,...n){const o={tag:t,attrs:e||{},children:n};return p(o.tag)&&o.children.length===0&&o.attrs.children&&(o.children=o.attrs.children),o}function C({children:t}){return t}const D=Symbol("Fragment");C.prototype[D]=D;function M(t){return typeof t=="function"&&t.prototype[D]===D}let V=!1;function kt(t){V=t}const Z=[];let qt=!1;function we(t){if(!V){if(qt){_(t);return}Z.push(t)}}function jt(){Z.forEach(t=>{t()}),Z.length=0,qt=!0}const Ht=new WeakMap;function vt(t,e=[]){return t.forEach(n=>{d(n)&&(p(n.tag)?e.push({comp:n.tag,compId:n.tag.prototype._id,props:P(n.attrs,{children:t})}):T(n.tag)&&vt(n.children,e))}),e}function ht(t,e=[]){const n=Ht.get(t)||[];return e.push(...n),n.forEach(o=>{const s=ht(o.comp);e.push(...s)}),e}const tt=new Map;function Se(t,e){if(V)return;const n=t.prototype._id,o=tt.get(n)||[];o.some(r=>r===e)||(o.push(e),tt.set(n,o))}function Nt(t){const e=ht(t).map(o=>o.compId);e.unshift(t.prototype._id);const n=[];e.forEach(o=>{const s=tt.get(o)||[];n.push(...s)}),n.forEach(o=>{o()})}const et=[];let Yt=!1;function Ee(t){if(!V){if(Yt){t();return}et.push(t)}}function ke(){et.forEach(t=>{t()}),et.length=0,Yt=!0}const nt=new Map;function je(t,e){if(V)return;const n=t.prototype._id,o=nt.get(n)||[];o.some(r=>r===e)||(o.push(e),nt.set(n,o))}function Ot(t){const e=ht(t).map(o=>o.compId);e.unshift(t.prototype._id);const n=[];e.forEach(o=>{const s=nt.get(o)||[];n.push(...s)}),n.forEach(o=>{o()})}function k(t,e,n){if(z(t))return pt(t,e,n);if(M(t))return q(n);if(p(t)){const o=P(e,{children:n});t.prototype._id=ue();const s=t(o);return T(s)?L(s):(Ht.set(t,vt(s.children)),k(s.tag,s.attrs,s.children))}}function pt(t,e={},n=[""]){if(M(t))return k(t,e,n);const o=document.createElement(t);n.forEach(s=>{if(!ft(s)){if(T(s)){const r=L(s);r.nodeValue=s,o.appendChild(r);return}if(typeof s=="function"){const r=q([s]);o.appendChild(r);return}if(F(s)){const r=q(s);o.appendChild(r);return}if(at(s)){const r=pt(s.tag,s.attrs,s.children);o.appendChild(r);return}if(d(s)&&p(s.tag)){const r=k(s.tag,s.attrs,s.children);o.appendChild(r);return}}});for(const s in e){const r=e[s];o[s]=r,s==="ref"&&(r.value=o),typeof r=="function"&&Dt(s)&&A(()=>{o[s]=r()})}if(e.style&&d(e.style))for(const s in e.style){const r=e.style[s];typeof r=="function"?A(()=>o.style[s]=r()):o.style[s]=r}return o}function q(t){const e=document.createDocumentFragment();return t.forEach(n=>{if(!ft(n)){if(T(n)){const o=L(n);o.nodeValue=n,e.appendChild(o);return}if(typeof n=="function"){Ne(e,n);return}if(F(n)){const o=q(n);e.appendChild(o);return}if(at(n)){const o=pt(n.tag,n.attrs,n.children);e.appendChild(o);return}if(d(n)&&p(n.tag)){const o=k(n.tag,n.attrs,n.children);e.appendChild(o);return}}}),e}function At(t){if(T(t))return L(t);if(at(t)||d(t)&&p(t.tag))return k(t.tag,t.attrs,t.children)}function Ne(t,e){let n=[],o=!0,s=null;const r=L("");t.appendChild(r),A(()=>{let i=e();if(i&&d(i)&&M(i.tag))return;F(i)||(i=[i]),i=i.filter(l=>!ft(l));let u=0;for(;u<i.length;){let l=i[u];const h=u,f=n.findIndex(g=>g.key===h);if(f>=0){if(ct(l,n[f].tree)){u++;continue}const g=At(l),w=n[f].tree;p(w.tag)&&Ot(w.tag),n[f].node.parentElement.replaceChild(g,n[f].node),p(w.tag)&&Nt(w.tag),n[f].tree=l,n[f].node=g}else{const g=At(l);if(o)t.appendChild(g);else if(n.length===0)s??(s=r.parentElement),s.insertBefore(g,r.nextSibling);else{const w=n[n.length-1].node,oe=w.nextSibling;w.parentElement.insertBefore(g,oe)}n.push({key:h,tree:l,node:g})}u++}if(n.length>i.length){for(let l=i.length;l<n.length;l++){const h=n[l].tree;p(h.tag)&&Ot(h.tag),n[l].node.remove(),p(h.tag)&&Nt(h.tag)}n.splice(i.length,n.length-i.length)}o=!1})}function dt(t,e={},n=[""]){if(M(t)){const r=P(e,{children:n}),i=t(r);return H(i)}if(p(t)){const r=P(e,{children:n}),i=t(r);return dt(i.tag,i.attrs,i.children)}let o="";for(const r in e){if(r.startsWith("on")||r==="ref")continue;let i=typeof e[r]=="function"&&Dt(r)?e[r]():e[r];if(r==="className"){o+=` class=${i}`;continue}if(r==="style"&&d(i)){for(const u in i)typeof i[u]=="function"&&(i[u]=i[u]());i='"'+JSON.stringify(i).slice(1,-1).replaceAll('"',"").replaceAll(",",";")+'"'}o+=` ${r}=${i}`}const s=H(n);return`<${t}${o}>${s}</${t}>`}function H(t){let e="";return t.forEach(n=>{if(T(n)){e+=n.toString();return}if(F(n)){e+=H(n);return}if(typeof n=="function"){const o=n();e+=H([o]);return}if(d(n)){e+=dt(n.tag,n.attrs,n.children);return}}),e}function Oe({tag:t,attrs:e,children:n}){const o=k(t,e,n);if(ke(),o instanceof DocumentFragment){const s=o.children[0];_(()=>{s.parentNode&&jt()})}else o instanceof HTMLElement&&_(()=>{o.parentNode&&jt()});return o}function zt({tag:t,attrs:e,children:n}){kt(!0);const o=dt(t,e,n);return kt(!1),o}const Ae=Object.freeze(Object.defineProperty({__proto__:null,Fragment:C,binding:A,computed:Ut,createSignal:Lt,customRef:_e,h:c,isProxy:he,isReactive:ut,isRef:Bt,markRaw:pe,nextTick:_,onBeforeMount:Ee,onBeforeUnmount:je,onMounted:we,onUnmounted:Se,reactive:b,readonly:It,ref:X,render:Oe,renderToString:zt,toRaw:fe,toRef:ge,toRefs:me,unref:de,watch:K,watchEffect:Re},Symbol.toStringTag,{value:"Module"}));let R="",j,gt=!0,ot="";function Kt(t){R=t.base||"/",j=t.mode||"history",gt=t.isBrowser??!0,ot=t.SSR_DATA_KEY||"g_initialProps"}function mt(t){if(z(t))return t;t=t;const e=t.path;let n="";for(const r in t.query)n+=`&${r}=${t.query[r]}`;n=n?"?"+n:"";const o=t.hash?"#"+t.hash:"";return e+n+o}function Pe(t){const e={};return t.replace("?","").split("&").forEach(o=>{const[s,r]=o.split("=");s&&r&&(e[s]=r)}),e}function B(t){return t.replace(/\/+/g,"/")}const O=b({path:"",query:{},hash:"",meta:{}});function x(t){const e=new URL(B("http://0.0.0.0/"+t));O.path=e.pathname.replace(R,"/"),O.query=Pe(e.search),O.hash=e.hash}function xe(){if(!O.path&&gt){let t="";j==="history"?t=location.href.replace(location.origin+R,""):t=location.hash.slice(1),x(t)}return O}function Te(t){const e=mt(t);j==="history"?history.pushState({},"",B(R+"/"+e)):location.hash=e,x(e)}function Ce(t){const e=mt(t);j==="history"?history.replaceState({},"",B(R+"/"+e)):location.hash=e,x(e)}function Me(t){history.go(t)}function Jt(){return{push:Te,replace:Ce,go:Me}}function yt(t){t.exact??(t.exact=!0);const e=t.component;return c(e,null)}const v=Symbol("Route");yt.prototype[v]=v;function rt(t){return typeof t=="function"&&t.prototype[v]===v}function Ie(t){return c("div",null)}const Y=Symbol("action");function Fe(t){return typeof t=="function"&&t.prototype[Y]===Y}var m;class Le{constructor(e,n){a(this,"state");a(this,"actions");wt(this,m,!0);this.state=b(S(e)),K(()=>this.state,()=>{Rt(this,m)&&this._merge(e)},{deep:!0}),this.actions={};for(const o in n){let s=function(...i){N(r,m,!1);const u=n[o](...i);r._merge(e),y(u)&&u[Symbol.toStringTag]==="Promise"?u.then(()=>{r._merge(e),_(()=>N(r,m,!0))}):(r._merge(e),_(()=>N(r,m,!0)))};const r=this;s.prototype[Y]=Y,this.actions[o]=s}}_merge(e){const n=Object.keys(e);for(const o in e)this.state[o]=e[o];for(const o in this.state)Fe(this.state[o])||!n.includes(o)&&delete this.state[o]}get store(){N(this,m,!1);const e=Object.assign(this.state,this.actions);return _(()=>N(this,m,!0)),e}}m=new WeakMap;function Ve(t,e){return()=>new Le(t,e).store}let Pt=!0;function Gt(t,e=!0){const n=b({tag:"",attrs:{},children:[]});return K(()=>O.path,async o=>{const s=t.children.filter(i=>d(i)&&rt(i.tag)),r=Qt(s,o);if(r){e&&typeof r.tag.prototype.getInitialProps=="function"&&(Pt&&window[ot]?(delete window[ot],Pt=!1):t.Loading&&(n.tag=t.Loading));for(const i in r)n[i]=r[i]}},{immediate:!0}),{currentTree:n}}function Qt(t,e){const n=t.find(r=>r.attrs.exact||r.attrs.exact===void 0?e===r.attrs.path:(e+"/").startsWith(B(r.attrs.path+"/")));if(!n)return null;const o={tag:"",attrs:{},children:[]};o.tag=n.attrs.component;const s=[Qt(n.children,e)].filter(r=>r);if(o.children=s,s.length===0){const r=n.children[n.children.length-1];r&&rt(r.tag)&&!r.attrs.path&&(o.children=[P(o,{tag:r.attrs.component})])}if(n.attrs.exact===!1&&o.children.length===0){const r=t[t.length-1];if(r&&rt(r.tag)&&!r.attrs.path)return o.tag=r.attrs.component,o}return o}function Be(t){function e(){return j==="history"?location.href.replace(location.origin+R,""):location.hash.slice(1)}x(e()),window.addEventListener("popstate",()=>{x(e())});const{currentTree:n}=Gt(t);return c(C,null,_t(n))}function _t(t){return()=>t.tag?c(t.tag,null,t.children.length>0?_t(t.children[0]):null):null}function $e(t){let e="";if(j==="history")e=t.url.replace(R,"");else{const o=t.url.match(/#.*/);e=o?o[0]:""}x(e);const{currentTree:n}=Gt({children:t.children,url:e},!1);return c(C,null,_t(n))}function Xt(t){return c(C,null,gt?c(Be,{...t}):c($e,{...t}))}const Ue={to:"/",type:"push"};function U(t){t=P(Ue,t);const e=z(t.to)?t.to:mt(t.to),n=B(R+(j==="hash"?"#"+e:e)),o=Jt();function s(r){r.preventDefault(),t.type==="push"?o.push(e):o.replace(e)}return c("a",{href:n,onclick:s},t.children)}const We=Object.freeze(Object.defineProperty({__proto__:null,Link:U,Redirect:Ie,Route:yt,Router:Xt,initRouter:Kt,useRoute:xe,useRouter:Jt},Symbol.toStringTag,{value:"Module"}));function De(t,e=0){return Math.floor(Math.random()*(t-e)+e)}function qe(t="000000",e="ffffff"){const n=parseInt(t,16),o=parseInt(e,16);return"#"+De(o,n).toString(16)}const st={"text/html":[".html"],"text/css":[".css"],"application/javascript;":[".js"],"application/json":[".json"],"image/vnd.microsoft.icon":[".ico"],"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/gif":[".gif"],"application/pdf":[".pdf"],"font/woff2":[".worf2"],"font/woff":[".worf"],"font/ttf":[".ttf"],"application/octet-stream":[".mp4",".avi"]};function He(){const t=Object.values(st).flat();return[".gz"].concat(t)}function ve(t){t=t.toLowerCase();let e=null;for(const n in st)if(st[n].includes(t)){e=n;break}return e}const Ye="page-home-9fa45b",ze="red-font-8020a0",xt={"page-home":"page-home-9fa45b",pageHome:Ye,"red-font":"red-font-8020a0",redFont:ze},Zt={count:0},Ke={setCount(t){Zt.count=t}},Je=Ve(Zt,Ke);function te(t){const e=Je(),n=X(0),o=X(null);return c("div",{className:xt["page-home"]},c("h1",null,"Store: ",()=>e.count),c("button",{onclick:()=>e.setCount(++e.count)},"Store change"),c("h1",{ref:o},"Ref: count ",c("span",{className:xt["red-font"]},()=>n.value)),c("button",{onclick:()=>n.value++},"count++"),c(Ge,{count:()=>n.value}),c("h1",null,"Page.getInitialProps: ",t.data))}te.prototype.getInitialProps=async()=>new Promise(t=>{setTimeout(()=>{t(123)},300)});function Ge(t){const e=Ut(()=>qe().slice(0,-1)+t.count().toString().slice(0,1));return c("h1",{style:{color:()=>e.value}},"子组件 ",t.count)}const Qe="page-about-d0f5f3",Xe={"page-about":"page-about-d0f5f3",pageAbout:Qe};function Ze(){return c("div",{className:Xe["page-about"]},c("p",null,"自个儿手写的 Vue 响应式源码，实现个大概！"),c("strong",null,"Vue API"),c("p",null,Object.keys(Ae).join("、")),c("strong",null,"Router API"),c("p",null,Object.keys(We).join("、")))}const tn="not-found-710606",en={"not-found":"not-found-710606",notFound:tn};function nn(){return c("div",{className:en["not-found"]},"404")}const on="header-937207",rn="github-211c2b",Tt={header:on,github:rn},J={BASE_URL:"/",NODE_ENV:"production",BASE_API:"/api",DEPLOY_URL:"/"},ee=[{path:"/",component:te,exact:!0},{path:"/about",component:Ze},{component:nn}];function sn(t){return Kt({base:J.BASE_URL,mode:"history",isBrowser:t.isBrowser}),c(C,null,c("nav",{className:Tt.header},c(U,{to:"/"},"首页"),c(U,{to:"/about"},"关于"),c(U,{to:"/404"},"notFound"),c("a",{className:Tt.github,href:"https://github.com/yubo9807/mvvm_vue3",target:"_blank"},"GitHub")),c(Xt,{url:t.url,data:t.data,Loading:cn},...ee.map(e=>c(yt,{...e}))))}function cn(){return c("div",null,"loading...")}const ne=J.DEPLOY_URL.slice(1),$=Mt.readFileSync(Q.resolve(__dirname,ne,"index.html"),"utf-8");async function un(t){const e=ee.find(n=>n.exact?t===n.path:(t+"/").startsWith(n.path+"/"));if(e&&typeof e.component.prototype.getInitialProps=="function")return await e.component.prototype.getInitialProps()}const ln=ie.createServer(async(t,e)=>{const n=t.url.replace(J.BASE_URL,"/"),o=Q.extname(n);if(He().includes(o)){const s=Q.resolve(__dirname,ne,n.slice(1));Mt.readFile(s,(r,i)=>{if(r)e.writeHead(404,{"Content-Type":"text/plain"}),e.end("Not Found");else{const u=ve(o);u&&e.setHeader("Content-Type",u),e.write(i),e.end()}})}else{const s=await un(n),r=zt(c(sn,{isBrowser:!1,url:n,data:s})),i=$.search("</body>"),u=s===void 0?"":`<script>window.g_initialProps=${JSON.stringify(s)}<\/script>`,l=$.slice(0,i)+u+$.slice(i,$.length);e.write(l.replace("<!--ssr-outlet-->",r)),e.end()}}),Ct=3e3;ln.listen(Ct,()=>{console.log(`http://localhost:${Ct}${J.BASE_URL}`)});
