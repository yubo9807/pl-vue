"use strict";const pt=require("http"),z=require("fs"),L=require("path");function E(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function a(t){return["object","array"].includes(E(t))}function ht(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function J(t,e){if(a(t)&&a(e)){const n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;for(const c of n)if(!o.includes(c)||!J(t[c],e[c]))return!1;return!0}else return t===e}function k(t){return E(t)==="object"}function Y(t){return Array.isArray(t)}function Q(t){return typeof t=="string"}function H(t){Promise.resolve().then(t)}let b=null;const P=new WeakMap;function dt(t){b=t,t(),b=null}function mt(t){const e=P.get(t)||[],n=e.some(o=>b===o);b&&!n&&(e.push(b),P.set(t,e))}function C(t){const e=P.get(t);e&&e.forEach((n,o)=>{const c=n();typeof c=="boolean"&&c&&(e.splice(o,1),P.set(t,e))})}const yt=new WeakMap,O=new WeakMap,D={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function F(t){if(!a(t)||Object.isFrozen(t)||yt.get(t))return t;let e=null;return new Proxy(t,{get(n,o,c){if(o===D.RAW)return n;if(a(n[o]))return F(n[o]);const r=Reflect.get(n,o,c);return mt(n),r},set(n,o,c,r){if(n[D.IS_READONLY])return!0;if(a(n[o])){const g=n[o],M=new Set;for(const p in c)M.add(p),this.set(g,p,c[p],r[o]);for(const p in g)M.has(p)||this.deleteProperty(g,p);return!0}if(Reflect.get(n,o,r)===c)return!0;const l=Reflect.set(n,o,c,r),y=O.get(n)||new Set;y.add(o);const ft=y.size;return O.set(n,y),H(()=>{const g=Reflect.get(n,o,r);l&&g===c&&ft===1&&C(n),O.delete(n)}),l},deleteProperty(n,o){const c=Reflect.get(n,o);if(a(c)){for(const l in c)this.deleteProperty(c,l);return!0}const r=ht(n,o),i=Reflect.deleteProperty(n,o);return e=o,H(()=>{r&&i&&c!==void 0&&o===e&&(C(n),e=null)}),i}})}const w=function(){const t=new WeakMap,e=["null","weakset","weakmap"],n={set(o){const c=new Set;for(const r of o)c.add(w(r));return c},map(o){const c=new Map;for(const[r,i]of o.entries())c.set(r,w(i));return c}};return function(o){const c=E(o);if(typeof o!="object"||e.includes(c))return o;if(t.has(o))return t.get(o);if(n[c])return n[c](o);const r=Y(o)?[]:{};Object.setPrototypeOf(r,Object.getPrototypeOf(o)),t.set(o,r);for(const i in o)r[i]=w(o[i]);return r}}();function j(t,e){return Object.assign({},t,e)}function gt(t,e,n={}){let o=!1;if(o)return;const c=t();n.immediate&&e(c,void 0);let r=w(c),i=!0;return dt(()=>{const l=t();if(a(l)){n.deep&&!J(l,r)&&(e(l,r),r=w(l));return}if(i){i=!1;return}e(l,r),r=l}),()=>{o=!0}}function bt(t){return["string","number"].includes(typeof t)&&t!==""}function wt(t){return!/^on/.test(t)}function X(t){return typeof t=="function"&&!Z(t)}function s(t,e,...n){const o={tag:t,attrs:e||{},children:n};return X(o.tag)&&o.children.length===0&&o.attrs.children&&(o.children=o.attrs.children),o}function I({children:t}){return t}const A=Symbol("Fragment");I.prototype[A]=A;function Z(t){return typeof t=="function"&&t.prototype[A]===A}function B(t,e={},n=[""]){if(Z(t)){const r=j(e,{children:n}),i=t(r);return T(i)}if(X(t)){const r=j(e,{children:n}),i=t(r);return B(i.tag,i.attrs,i.children)}let o="";for(const r in e){if(r.startsWith("on")||r==="ref")continue;let i=typeof e[r]=="function"&&wt(r)?e[r]():e[r];if(r==="className"){o+=` class=${i}`;continue}if(r==="style"&&k(i)){for(const l in i)typeof i[l]=="function"&&(i[l]=i[l]());i='"'+JSON.stringify(i).slice(1,-1).replaceAll('"',"").replaceAll(",",";")+'"'}o+=` ${r}=${i}`}const c=T(n);return`<${t}${o}>${c}</${t}>`}function T(t){let e="";return t.forEach(n=>{if(bt(n)){e+=n.toString();return}if(Y(n)){e+=T(n);return}if(typeof n=="function"){const o=n();e+=T([o]);return}if(k(n)){e+=B(n.tag,n.attrs,n.children);return}}),e}function Rt({tag:t,attrs:e,children:n}){return B(t,e,n)}let f="",d,tt=!0,x="";function St(t){f=t.base||"/",d=t.mode||"history",tt=t.isBrowser??!0,x=t.SSR_DATA_KEY||"g_initialProps"}function $(t){if(Q(t))return t;t=t;const e=t.path;let n="";for(const r in t.query)n+=`&${r}=${t.query[r]}`;n=n?"?"+n:"";const o=t.hash?"#"+t.hash:"";return e+n+o}function _t(t){const e={};return t.replace("?","").split("&").forEach(o=>{const[c,r]=o.split("=");c&&r&&(e[c]=r)}),e}function m(t){return t.replace(/\/+/g,"/")}const _=F({path:"",query:{},hash:"",meta:{}});function R(t){const e=new URL(m("http://0.0.0.0/"+t));_.path=e.pathname.replace(f,"/"),_.query=_t(e.search),_.hash=e.hash}function Pt(t){const e=$(t);d==="history"?history.pushState({},"",m(f+"/"+e)):location.hash=e,R(e)}function jt(t){const e=$(t);d==="history"?history.replaceState({},"",m(f+"/"+e)):location.hash=e,R(e)}function At(t){history.go(t)}function Tt(){return{push:Pt,replace:jt,go:At}}function et(t){t.exact??(t.exact=!0);const e=t.component;return s(e,null)}const v=Symbol("Route");et.prototype[v]=v;function N(t){return typeof t=="function"&&t.prototype[v]===v}function nt(t,e){const n=t.find(r=>r.attrs.exact||r.attrs.exact===void 0?e===r.attrs.path:(e+"/").startsWith(m(r.attrs.path+"/")));if(!n)return null;const o={tag:"",attrs:{},children:[]};o.tag=n.attrs.component;const c=[nt(n.children,e)].filter(r=>r);if(o.children=c,c.length===0){const r=n.children[n.children.length-1];r&&N(r.tag)&&!r.attrs.path&&(o.children=[j(o,{tag:r.attrs.component})])}if(n.attrs.exact===!1&&o.children.length===0){const r=t[t.length-1];if(r&&N(r.tag)&&!r.attrs.path)return o.tag=r.attrs.component,o}return o}let V=!0;function ot(t,e=!0){const n=F({tag:"",attrs:{},children:[]});return gt(()=>_.path,async o=>{const c=t.children.filter(i=>k(i)&&N(i.tag)),r=nt(c,o);if(r){e&&typeof r.tag.prototype.getInitialProps=="function"&&(V&&window[x]?(delete window[x],V=!1):t.Loading&&(n.tag=t.Loading));for(const i in r)n[i]=r[i]}},{immediate:!0}),{currentTree:n}}function rt(t){const e=t(),n=e.tag;return s(I,null,()=>s(n,null,e.children[0]&&rt(()=>e.children[0])))}function vt(t){function e(){return d==="history"?location.href.replace(location.origin+f,""):location.hash.slice(1)}R(e()),window.addEventListener("popstate",()=>{R(e())});const{currentTree:n}=ot(t);return rt(()=>n)}function Ot(t){let e="";if(d==="history")e=t.url.replace(f,"");else{const o=t.url.match(/#.*/);e=o?o[0]:""}R(e);const{currentTree:n}=ot({children:t.children,url:e},!1);return s("tier",{tree:()=>n})}function Lt(t){return s(I,null,tt?s(vt,{...t}):s(Ot,{...t}))}const xt={to:"/",type:"push"};function q(t){t=j(xt,t);const e=Q(t.to)?t.to:$(t.to),n=m(f+(d==="hash"?"#"+e:e)),o=Tt();function c(r){r.preventDefault(),t.type==="push"?o.push(e):o.replace(e)}return s("a",{href:n,onclick:c},t.children)}const Nt="banner-64e93c",Ut="box-e24f47",Et="article-e5ab12",kt="paragraph-6f9bd7",Ft="mark-66b760",It="peculiarity-fd110f",h={banner:Nt,box:Ut,article:Et,paragraph:kt,mark:Ft,peculiarity:It};function W(...t){return t.join(" ").trim().replace(/\s+/," ")}const U={"text/html":[".html"],"text/css":[".css"],"application/javascript;":[".js"],"application/json":[".json"],"image/vnd.microsoft.icon":[".ico"],"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/gif":[".gif"],"application/pdf":[".pdf"],"font/woff2":[".worf2"],"font/woff":[".worf"],"font/ttf":[".ttf"],"application/octet-stream":[".mp4",".avi"]};function Bt(){const t=Object.values(U).flat();return[".gz"].concat(t)}function $t(t){t=t.toLowerCase();let e=null;for(const n in U)if(U[n].includes(t)){e=n;break}return e}const u={BASE_URL:"/",NODE_ENV:"production",BASE_API:"/api",DEPLOY_URL:"/",GITHUB_URL:"https://github.com/yubo9807/"};function ct(t){return s("div",null,s("div",{className:h.banner},s("div",{className:h.box},s("strong",null,"Pl Vue"),s("p",null,"一个 JS 库，只关心数据与函数之间的联动"))),s("article",{className:W("leayer","module-gap",h.article)},s("p",{className:h.paragraph},"Plagiarize Vue 是一个轻量级、不依赖任何第三方库的 JS 数据响应式库，除响应式 API 外，该库还提供了组件化、挂载钩子、Router、Store 以及服务端渲染相关 API，项目搭建可参考  ",s("a",{href:u.GITHUB_URL+"mvvm_vue3"},"GitHub"),"。"),s("p",{className:h.mark},"该库本身与 Vue 框架无任何关系，只是多数 API 在命名上相同而已。")),s("ul",{className:W("leayer","module-gap",h.peculiarity)},s("li",null,s("h2",null,"响不响应式的，高度交予开发者决定"),s("p",null,"JSX 编程方式，响应式数据统一使用函数的方式包裹。",s("a",{href:u.GITHUB_URL+"mvvm_vue3",target:"_blank"},"了解更多"))),s("li",null,s("h2",null,"无虚拟 DOM 参与"),s("p",null,"将用到响应式数据的函数进行收集，在数据更新后执行相应的函数。因此直接省去了虚拟 DOM 的比较。")),s("li",null,s("h2",null,"拿来就用，灵活多变"),s("p",null,"无需脚手架，原生应用亦可构建。",s("a",{href:u.GITHUB_URL+"single-page",target:"_blank"},"代码示例"))),s("li",null,s("h2",null,"代码精简，打包后不到 15k"),s("p",null,"手写 h 与 Fragment，将代码体积精简到极致。"))))}ct.prototype.getInitialProps=async()=>(console.log("home"),"home");function Mt(){return console.log("docs"),s("div",null,"docs")}const Ht="not-found-710606",Ct={"not-found":"not-found-710606",notFound:Ht};function Dt(){return s("div",{className:Ct["not-found"]},"404")}const Vt="header-d58b7b",qt="navigation-968f91",G={header:Vt,navigation:qt};function Wt(){return s("header",{className:G.header},s("div",null,s(q,{to:"/"},s("h1",null,"Pl Vue"))),s("nav",{className:G.navigation},s(q,{to:"/docs"},"文档"),s("a",{href:u.GITHUB_URL+"mvvm_vue3",target:"_blank"},"GitHub")))}const Gt="footer-3594d5",Kt={footer:Gt};function zt(){return s("footer",{className:Kt.footer},s("strong",null,"⚠️ 注意事项"),s("p",null,"本文文档仅供学习参考。并未发布正式版本，不提供任何商业用途。"))}const Jt="main-e1cb98",Yt={main:Jt};function st(t){return s("div",null,s(Wt,null),s("main",{className:Yt.main},t.children),s(zt,null))}st.prototype.getInitialProps=async()=>(console.log("loyout"),"loyout");const it=[{path:"/",component:st,exact:!1,routes:[{path:"/",component:ct},{path:"/docs",component:Mt}]},{component:Dt}];function Qt(t){return St({base:u.BASE_URL,mode:"history",isBrowser:t.isBrowser}),s(Lt,{url:t.url,data:t.data},...lt(it))}function lt(t){return t?t.map(e=>{const{routes:n,...o}=e;return s(et,{...o},...lt(n))}):[]}const ut=u.DEPLOY_URL.slice(1),S=z.readFileSync(L.resolve(__dirname,ut,"index.html"),"utf-8");async function at(t,e){const n=t.find(o=>o.exact||o.exact===void 0?e===o.path:(e+"/").startsWith(m(o.path+"/")));return n&&typeof n.component.prototype.getInitialProps=="function"?await n.component.prototype.getInitialProps():n.routes&&n.routes.length>0?await at(n.routes,e):void 0}const Xt=pt.createServer(async(t,e)=>{const n=t.url.replace(u.BASE_URL,"/"),o=L.extname(n);if(Bt().includes(o)){const c=L.resolve(__dirname,ut,n.slice(1));z.readFile(c,(r,i)=>{if(r)e.writeHead(404,{"Content-Type":"text/plain"}),e.end("Not Found");else{const l=$t(o);l&&e.setHeader("Content-Type",l),e.write(i),e.end()}})}else{const c=await at(it,n),r=Rt(s(Qt,{isBrowser:!1,url:n,data:c})),i=S.search("</body>"),l=c===void 0?"":`<script>window.g_initialProps=${JSON.stringify(c)}<\/script>`,y=S.slice(0,i)+l+S.slice(i,S.length);e.write(y.replace("<!--ssr-outlet-->",r)),e.end()}}),K=3e3;Xt.listen(K,()=>{console.log(`http://localhost:${K}${u.BASE_URL}`)});
