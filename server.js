"use strict";var Jt=Object.defineProperty;var Gt=(t,e,n)=>e in t?Jt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var a=(t,e,n)=>(Gt(t,typeof e!="symbol"?e+"":e,n),n),ft=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var pt=(t,e,n)=>(ft(t,e,"read from private field"),n?n.call(t):e.get(t)),dt=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},E=(t,e,n,o)=>(ft(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);const Qt=require("http"),kt=require("fs"),K=require("path");function f(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function I(t){return["object","array"].includes(f(t))}function Xt(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Z(t,e){if(["object","array"].includes(f(t))&&["object","array"].includes(f(e))){const n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;for(const r of n)if(!o.includes(r)||!Z(t[r],e[r]))return!1;return!0}else return t===e}function m(t){Promise.resolve().then(t)}let T=null;const L=new WeakMap;function C(t){T=t,t(),T=null}function Zt(t){const e=L.get(t)||[],n=e.some(o=>T===o);T&&!n&&(e.push(T),L.set(t,e))}function ht(t){const e=L.get(t);e&&e.forEach((n,o)=>{const r=n();typeof r=="boolean"&&r&&(e.splice(o,1),L.set(t,e))})}function Ct(t){return Reflect.defineProperty(t,w.IS_READONLY,{value:!0}),new Proxy(t,{get(e,n){return n===w.RAW?e:Reflect.get(e,n)},set(e,n,o){const r=Reflect.get(e,n);return console.warn(`Set operation on key '${n.toString()}' failed: target is readonly.`,{[n.toString()]:r}),r},deleteProperty(e,n){const o=Reflect.get(e,n);return console.warn(`Delete operation on key '${n.toString()}' failed: target is readonly.`,{[n.toString()]:o}),o}})}function te(t){return t&&Ct(t)[w.IS_READONLY]}const Ot=new WeakMap,w={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function R(t){if(!I(t))return console.warn(`lue cannot be made reactive: ${t}`),t;if(Ot.get(t))return t;let e=null;return new Proxy(t,{get(n,o,r){if(o===w.RAW)return n;Zt(n);const s=Reflect.get(n,o,r);return I(s)?R(s):s},set(n,o,r,s){const i=Reflect.get(n,o,s),c=Reflect.set(n,o,r,s);return n[w.IS_READONLY]?i:(m(()=>{const l=Reflect.get(n,o,s);c&&i!==r&&l===r&&ht(n)}),c)},deleteProperty(n,o){Reflect.get(n,o),Xt(n,o);const r=Reflect.deleteProperty(n,o);return e=o,m(()=>{o===e&&(ht(n),e=null)}),r}})}function tt(t){return!!t[w.RAW]}function ee(t){return tt(t)?t[w.RAW]:t}function ne(t){return tt(t)||te(t)}function oe(t){return I(t)&&Ot.set(t,!0),t}function xt(t){const e=R({value:t});function n(){return e.value}function o(r){e.value=r}return[n,o]}const et="__v_isRef";var nn;class At{constructor(e){a(this,nn,!0);a(this,"__v_isShallow",!1);a(this,"_rawValue");a(this,"_value");a(this,"getSignal");a(this,"setSignal");this._rawValue=e;const[n,o]=xt(e);this.getSignal=n,this.setSignal=o,this._value=n()}get value(){return this.getSignal()}set value(e){this.setSignal(e),this._rawValue=e}}nn=et;function M(t){return new At(t)}function Pt(t){return t&&!!t[et]}function re(t){return Pt(t)?t.value:t}class Tt{constructor(e,n,o=void 0){a(this,"__v_isRef",!0);a(this,"_defaultValue");a(this,"_key");a(this,"_object");this._defaultValue=o,this._key=n,this._object=e}get value(){return this._object[this._key]}set value(e){this._object[this._key]=e}}function se(t,e,n=void 0){return new Tt(t,e,n)}function ie(t){const e={};for(const n in t)e[n]=new Tt(t,n);return e}class ce extends At{constructor(n){let o=!1;const{get:r,set:s}=n(()=>o=!0,()=>this.setValue());super(r());a(this,"_get");a(this,"_set");this.__v_isRef=o,this._get=r,this._set=s}get value(){return this.__v_isRef?super.value:this._get()}set value(n){this._set(n)}setValue(){super.value=this._get()}}function ue(t){return new ce(t)}class ae{constructor(e){a(this,"fn");this.fn=e}}var on;class gt{constructor(e,n){a(this,"__v_isReadonly",!0);a(this,on,!0);a(this,"_cacheable",!0);a(this,"_dirty",!0);a(this,"computed");a(this,"_setter");this.computed=new ae(e),this._setter=n}get value(){return this.computed.fn()}set value(e){this._setter?this._setter(e):console.warn("Write operation failed: computed value is readonly")}}on=et;function It(t){return typeof t=="function"?new gt(t):new gt(t.get,t.set)}function N(t){return t instanceof Array?fe(t):f(t)==="object"?le(t):t}function le(t){let e={},n=Object.getOwnPropertyNames(t);for(let o=0;o<n.length;o++)e[n[o]]=N(t[n[o]]);return e}function fe(t){let e=new Array(t.length);for(let n=0;n<e.length;n++)e[n]=N(t[n]);return e}function U(t,e,n={}){let o=!1;if(o)return;const r=t();let s=N(r);return n.immediate&&e(r,void 0),C(()=>{const i=[];if(o)return i.length>0&&i.forEach(l=>l()),!0;const c=t();I(r)?n.deep&&!Z(c,s)&&(e(c,R(s)),s=N(c),Mt(c).forEach(l=>{const d=U(()=>l,()=>{e(c,R(s))},{deep:!0});i.push(d)})):c!==s&&(e(c,s),s=N(c))}),()=>{o=!0}}function Mt(t,e=[]){for(const n in t)I(t[n])&&(e.push(t[n]),Mt(t[n],e));return e}function pe(t){let e=!1,n=!1;return C(()=>{if(e)return!0;t(o=>{n&&o(),n=!0})}),()=>{e=!0}}function x(t){return["string","number"].includes(typeof t)&&t!==""}function Ft(t){return!/^on/.test(t)}function nt(t){return f(t)==="object"&&(typeof t.tag=="string"||P(t.tag))}function p(t){return typeof t=="function"&&!P(t)}function ot(t){return[void 0,null,"",!0,!1].includes(t)}function u(t,e,...n){const o={tag:t,attrs:e||{},children:n};return p(o.tag)&&o.children.length===0&&o.attrs.children&&(o.children=o.attrs.children),o}function A({children:t}){return t}const B=Symbol("Fragment");A.prototype[B]=B;function P(t){return typeof t=="function"&&t.prototype[B]===B}let F=!1;function mt(t){F=t}const z=[];let $t=!1;function de(t){if(!F){if($t){m(t);return}z.push(t)}}function yt(){z.forEach(t=>{t()}),z.length=0,$t=!0}const vt=new WeakMap;function Vt(t,e=[]){return t.forEach(n=>{f(n)==="object"&&(p(n.tag)?e.push({comp:n.tag,compId:n.tag.prototype._id,props:Object.assign({},n.attrs,{children:t})}):x(n.tag)&&Vt(n.children,e))}),e}function rt(t,e=[]){const n=vt.get(t)||[];return e.push(...n),n.forEach(o=>{const r=rt(o.comp);e.push(...r)}),e}const J=new Map;function he(t,e){if(F)return;const n=t.prototype._id,o=J.get(n)||[];o.some(s=>s===e)||(o.push(e),J.set(n,o))}function bt(t){const e=rt(t).map(o=>o.compId);e.unshift(t.prototype._id);const n=[];e.forEach(o=>{const r=J.get(o)||[];n.push(...r)}),n.forEach(o=>{o()})}const G=[];let Lt=!1;function ge(t){if(!F){if(Lt){t();return}G.push(t)}}function me(){G.forEach(t=>{t()}),G.length=0,Lt=!0}const Q=new Map;function ye(t,e){if(F)return;const n=t.prototype._id,o=Q.get(n)||[];o.some(s=>s===e)||(o.push(e),Q.set(n,o))}function _t(t){const e=rt(t).map(o=>o.compId);e.unshift(t.prototype._id);const n=[];e.forEach(o=>{const r=Q.get(o)||[];n.push(...r)}),n.forEach(o=>{o()})}function be(){return Number(Math.random().toString().slice(2)).toString(32)}function S(t,e,n){if(typeof t=="string")return st(t,e,n);if(P(t))return W(n);if(p(t)){const o=Object.assign({},e,{children:n});t.prototype._id=be();const r=t(o);return x(r)?document.createTextNode(r.toString()):(vt.set(t,Vt(r.children)),S(r.tag,r.attrs,r.children))}}function st(t,e={},n=[""]){if(P(t))return S(t,e,n);const o=document.createElement(t);n.forEach(r=>{if(!ot(r)){if(x(r)){const s=document.createTextNode(r);s.nodeValue=r,o.appendChild(s);return}if(typeof r=="function"){const s=W([r]);o.appendChild(s);return}if(r instanceof Array){const s=W(r);o.appendChild(s);return}if(nt(r)){const s=st(r.tag,r.attrs,r.children);o.appendChild(s);return}if(f(r)==="object"&&p(r.tag)){const s=S(r.tag,r.attrs,r.children);o.appendChild(s);return}console.warn(`render: 不支持 ${r} 值渲染`)}});for(const r in e){const s=e[r];o[r]=s,r==="ref"&&(s.value=o),typeof s=="function"&&Ft(r)&&C(()=>{o[r]=s()})}if(e.style&&e.style instanceof Object)for(const r in e.style){const s=e.style[r];typeof s=="function"?C(()=>o.style[r]=s()):o.style[r]=s}return o}function W(t){const e=document.createDocumentFragment();return t.forEach(n=>{if(!ot(n)){if(x(n)){const o=document.createTextNode(n);o.nodeValue=n,e.appendChild(o);return}if(typeof n=="function"){_e(e,n);return}if(n instanceof Array){const o=W(n);e.appendChild(o);return}if(nt(n)){const o=st(n.tag,n.attrs,n.children);e.appendChild(o);return}if(f(n)==="object"&&p(n.tag)){const o=S(n.tag,n.attrs,n.children);e.appendChild(o);return}console.warn(`render: 不支持 ${n} 值渲染`)}}),e}function wt(t){if(x(t))return document.createTextNode(t.toString());if(nt(t)||f(t)==="object"&&p(t.tag))return S(t.tag,t.attrs,t.children)}function _e(t,e){let n=[],o=!0,r=null;const s=document.createTextNode("");t.appendChild(s),C(()=>{let i=e();if(i&&f(i)==="object"&&P(i.tag)){console.warn("不支持响应式节点片段渲染");return}i instanceof Array||(i=[i]),i=i.filter(l=>!ot(l));let c=0;for(;c<i.length;){let l=i[c];const d=c,b=n.findIndex(h=>h.key===d);if(b>=0){if(Z(l,n[b].tree)){c++;continue}const h=wt(l),_=n[b].tree;p(_.tag)&&_t(_.tag),n[b].node.parentElement.replaceChild(h,n[b].node),p(_.tag)&&bt(_.tag),n[b].tree=l,n[b].node=h}else{const h=wt(l);if(o)t.appendChild(h);else if(n.length===0)r??(r=s.parentElement),r.insertBefore(h,s.nextSibling);else{const _=n[n.length-1].node,zt=_.nextSibling;_.parentElement.insertBefore(h,zt)}n.push({key:d,tree:l,node:h})}c++}if(n.length>i.length){for(let l=i.length;l<n.length;l++){const d=n[l].tree;p(d.tag)&&_t(d.tag),n[l].node.remove(),p(d.tag)&&bt(d.tag)}n.splice(i.length,n.length-i.length)}o=!1})}function it(t,e={},n=[""]){if(P(t)){const s=Object.assign({},e,{children:n}),i=t(s);return D(i)}if(p(t)){const s=Object.assign({},e,{children:n}),i=t(s);return it(i.tag,i.attrs,i.children)}let o="";for(const s in e){if(s.startsWith("on")||s==="ref")continue;let i=typeof e[s]=="function"&&Ft(s)?e[s]():e[s];if(s==="className"){o+=` class=${i}`;continue}if(s==="style"&&f(i)==="object"){for(const c in i)typeof i[c]=="function"&&(i[c]=i[c]());i='"'+JSON.stringify(i).slice(1,-1).replaceAll('"',"").replaceAll(",",";")+'"'}o+=` ${s}=${i}`}const r=D(n);return`<${t}${o}>${r}</${t}>`}function D(t){let e="";return t.forEach(n=>{if(x(n)){e+=n.toString();return}if(n instanceof Array){e+=D(n);return}if(typeof n=="function"){const o=n();e+=D([o]);return}if(f(n)==="object"){e+=it(n.tag,n.attrs,n.children);return}console.warn(`renderToString: 不支持 ${n} 值渲染`)}),e}function we({tag:t,attrs:e,children:n}){const o=S(t,e,n);if(me(),o instanceof DocumentFragment){const r=o.children[0];m(()=>{r.parentNode&&yt()})}else o instanceof HTMLElement&&m(()=>{o.parentNode&&yt()});return o}function Bt({tag:t,attrs:e,children:n}){mt(!0);const o=it(t,e,n);return mt(!1),o}const Re=Object.freeze(Object.defineProperty({__proto__:null,Fragment:A,binding:C,computed:It,createSignal:xt,customRef:ue,h:u,isProxy:ne,isReactive:tt,isRef:Pt,markRaw:oe,nextTick:m,onBeforeMount:ge,onBeforeUnmount:ye,onMounted:de,onUnmounted:he,reactive:R,readonly:Ct,ref:M,render:we,renderToString:Bt,toRaw:ee,toRef:se,toRefs:ie,unref:re,watch:U,watchEffect:pe},Symbol.toStringTag,{value:"Module"}));let y="",j,ct=!0,v="";function Wt(t){y=t.base||"",j=t.mode||"history",ct=t.isBrowser??!0,v=t.SSR_DATA_KEY||"g_initialProps"}function ut(t){const e=t.path;let n="";for(const s in t.query)n+=`&${s}=${t.query[s]}`;n=n?"?"+n:"";const o=t.hash?"#"+t.hash:"";return e+n+o}function Se(t){const e={};return t.replace("?","").split("&").forEach(o=>{const[r,s]=o.split("=");r&&s&&(e[r]=s)}),e}function Y(t){return t.replace(/\/+/g,"/")}const k=R({path:"",query:{},hash:"",meta:{}});function O(t){const e=new URL(Y("http://0.0.0.0/"+t));k.path=e.pathname.replace(y,"/"),k.query=Se(e.search),k.hash=e.hash}function je(){if(!k.path&&ct){let t="";j==="history"?t=location.href.replace(location.origin+y,""):t=location.hash.slice(1),O(t)}return k}function Ee(t){const e=typeof t=="string"?t:ut(t);j==="history"?history.pushState({},"",Y(y+"/"+e)):location.hash=e,O(e)}function Ne(t){const e=typeof t=="string"?t:ut(t);j==="history"?history.replaceState({},"",Y(y+"/"+e)):location.hash=e,O(e)}function ke(t){history.go(t)}function Dt(){return{push:Ee,replace:Ne,go:ke}}function at(t){const e=t.component;return u(e,null)}const H=Symbol("Route");at.prototype[H]=H;function Rt(t){return typeof t=="function"&&t.prototype[H]===H}function Ce(t){return u("div",null)}let St=!0;function Ht(t,e=!0){const n=M(null),o=M(void 0);return U(()=>k.path,async r=>{const s=t.children.filter(c=>typeof c=="object"&&Rt(c.tag)),i=s.find(c=>c.attrs.exact?r===c.attrs.path:(r+"/").startsWith(c.attrs.path+"/"));if(i)if(e){const c=i.attrs.component;typeof c.prototype.getInitialProps=="function"?St&&window[v]?(o.value=window[v],delete window[v],St=!1):(t.Loading&&(n.value=t.Loading),o.value=await c.prototype.getInitialProps()):o.value=void 0,n.value=c}else n.value=i.attrs.component;else{const c=s[s.length-1];typeof c=="object"&&Rt(c.tag)&&!c.attrs.path?n.value=c.attrs.component:n.value=null}},{immediate:!0}),{CurrentComp:n,data:o}}function Oe(t){function e(){return j==="history"?location.href.replace(location.origin+y,""):location.hash.slice(1)}O(e()),window.addEventListener("popstate",()=>{O(e())});const{CurrentComp:n,data:o}=Ht(t);return u(A,null,()=>n.value?u(n.value,{data:o.value}):null)}function xe(t){let e="";if(j==="history")e=t.url.replace(y,"");else{const o=t.url.match(/#.*/);e=o?o[0]:""}O(e);const{CurrentComp:n}=Ht({children:t.children,url:e},!1);return u(A,null,()=>u(n.value,{data:t.data}))}function qt(t){return u(A,null,ct?u(Oe,{...t}):u(xe,{...t}))}const Ae={to:"/",type:"push"};function V(t){t=Object.assign({},Ae,t);const e=typeof t.to=="string"?t.to:ut(t.to),n=Y(y+(j==="hash"?"#"+e:e)),o=Dt();function r(s){s.preventDefault(),t.type==="push"?o.push(e):o.replace(e)}return u("a",{href:n,onclick:r},t.children)}const Pe=Object.freeze(Object.defineProperty({__proto__:null,Link:V,Redirect:Ce,Route:at,Router:qt,initRouter:Wt,useRoute:je,useRouter:Dt},Symbol.toStringTag,{value:"Module"}));function Te(t,e=0){return Math.floor(Math.random()*(t-e)+e)}function Ie(t="000000",e="ffffff"){const n=parseInt(t,16),o=parseInt(e,16);return"#"+Te(o,n).toString(16)}const X={"text/html":[".html"],"text/css":[".css"],"application/javascript;":[".js"],"application/json":[".json"],"image/vnd.microsoft.icon":[".ico"],"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/gif":[".gif"],"application/pdf":[".pdf"],"font/woff2":[".worf2"],"font/woff":[".worf"],"font/ttf":[".ttf"],"application/octet-stream":[".mp4",".avi"]};function Me(){const t=Object.values(X).flat();return[".gz"].concat(t)}function Fe(t){t=t.toLowerCase();let e=null;for(const n in X)if(X[n].includes(t)){e=n;break}return e}const $e="page-home-9fa45b",ve="red-font-8020a0",jt={"page-home":"page-home-9fa45b",pageHome:$e,"red-font":"red-font-8020a0",redFont:ve},q=Symbol("action");function Ve(t){return typeof t=="function"&&t.prototype[q]===q}var g;class Le{constructor(e,n){a(this,"state");a(this,"actions");dt(this,g,!0);this.state=R(N(e)),U(()=>this.state,()=>{pt(this,g)&&this._merge(e)},{deep:!0}),this.actions={};for(const o in n){let r=function(...i){E(s,g,!1);const c=n[o](...i);s._merge(e),typeof c=="object"&&c[Symbol.toStringTag]==="Promise"?c.then(()=>{s._merge(e),m(()=>E(s,g,!0))}):(s._merge(e),m(()=>E(s,g,!0)))};const s=this;r.prototype[q]=q,this.actions[o]=r}}_merge(e){const n=Object.keys(e);for(const o in e)this.state[o]=e[o];for(const o in this.state)Ve(this.state[o])||!n.includes(o)&&delete this.state[o]}get store(){E(this,g,!1);const e=Object.assign(this.state,this.actions);return m(()=>E(this,g,!0)),e}}g=new WeakMap;function Be(t,e){return()=>new Le(t,e).store}const Ut={count:0},We={setCount(t){Ut.count=t}},De=Be(Ut,We);function Yt(t){const e=De(),n=M(0),o=M(null);return u("div",{className:jt["page-home"]},u("h1",null,"Store: ",()=>e.count),u("button",{onclick:()=>e.setCount(++e.count)},"Store change"),u("h1",{ref:o},"Ref: count ",u("span",{className:jt["red-font"]},()=>n.value)),u("button",{onclick:()=>n.value++},"count++"),u(He,{count:()=>n.value}),u("h1",null,"Page.getInitialProps: ",t.data))}Yt.prototype.getInitialProps=async()=>new Promise(t=>{setTimeout(()=>{t(123)},300)});function He(t){const e=It(()=>Ie().slice(0,-1)+t.count().toString().slice(0,1));return u("h1",{style:{color:()=>e.value}},"子组件 ",t.count)}const qe="page-about-d0f5f3",Ue={"page-about":"page-about-d0f5f3",pageAbout:qe};function Ye(){return u("div",{className:Ue["page-about"]},u("p",null,"自个儿手写的 Vue 响应式源码，实现个大概！"),u("strong",null,"Vue API"),u("p",null,Object.keys(Re).join("、")),u("strong",null,"Router API"),u("p",null,Object.keys(Pe).join("、")))}const Ke="not-found-710606",ze={"not-found":"not-found-710606",notFound:Ke};function Je(){return u("div",{className:ze["not-found"]},"404")}const Ge="header-937207",Qe="github-211c2b",Et={header:Ge,github:Qe},lt="/",Kt=[{path:"/",component:Yt,exact:!0},{path:"/about",component:Ye},{component:Je}];function Xe(t){return Wt({base:lt,mode:"history",isBrowser:t.isBrowser}),u(A,null,u("nav",{className:Et.header},u(V,{to:"/"},"首页"),u(V,{to:"/about"},"关于"),u(V,{to:"/404"},"notFound"),u("a",{className:Et.github,href:"https://github.com/yubo9807/mvvm_vue3",target:"_blank"},"GitHub")),u(qt,{url:t.url,data:t.data,Loading:Ze},...Kt.map(e=>u(at,{...e}))))}function Ze(){return u("div",null,"loading...")}const $=kt.readFileSync(K.resolve(__dirname,lt.slice(1),"./client/index.html"),"utf-8");async function tn(t){t=t.replace(lt,"");const e=Kt.find(n=>n.exact?t===n.path:(t+"/").startsWith(n.path+"/"));if(e&&typeof e.component.prototype.getInitialProps=="function")return await e.component.prototype.getInitialProps()}const en=Qt.createServer(async(t,e)=>{const n=t.url,o=K.extname(n);if(Me().includes(o)){const r=K.resolve(__dirname,"./client",n.slice(1));kt.readFile(r,(s,i)=>{if(s)e.writeHead(404,{"Content-Type":"text/plain"}),e.end("Not Found");else{const c=Fe(o);c&&e.setHeader("Content-Type",c),e.write(i),e.end()}})}else{const r=await tn(n),s=Bt(u(Xe,{isBrowser:!1,url:n,data:r})),i=$.search("</body>"),c=r===void 0?"":`<script>window.g_initialProps=${JSON.stringify(r)}<\/script>`,l=$.slice(0,i)+c+$.slice(i,$.length);e.write(l.replace("<!--ssr-outlet-->",s)),e.end()}}),Nt=3e3;en.listen(Nt,()=>{console.log(`http://localhost:${Nt}`)});
