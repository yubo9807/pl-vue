"use strict";var oe=Object.defineProperty;var re=(t,e,n)=>e in t?oe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var l=(t,e,n)=>(re(t,typeof e!="symbol"?e+"":e,n),n),_t=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var bt=(t,e,n)=>(_t(t,e,"read from private field"),n?n.call(t):e.get(t)),Rt=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},j=(t,e,n,o)=>(_t(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);const se=require("http"),Tt=require("fs"),G=require("path");function st(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function _(t){return["object","array"].includes(st(t))}function ce(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ct(t,e){if(_(t)&&_(e)){const n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;for(const s of n)if(!o.includes(s)||!ct(t[s],e[s]))return!1;return!0}else return t===e}function g(t){return st(t)==="object"}function I(t){return Array.isArray(t)}function Y(t){return typeof t=="string"}function b(t){Promise.resolve().then(t)}function ie(){return Number(Math.random().toString().slice(2)).toString(32)}let M=null;const D=new WeakMap;function O(t){M=t,t(),M=null}function ue(t){const e=D.get(t)||[],n=e.some(o=>M===o);M&&!n&&(e.push(M),D.set(t,e))}function wt(t){const e=D.get(t);e&&e.forEach((n,o)=>{const s=n();typeof s=="boolean"&&s&&(e.splice(o,1),D.set(t,e))})}function Mt(t){return Reflect.defineProperty(t,w.IS_READONLY,{value:!0}),new Proxy(t,{get(e,n){return n===w.RAW?e:Reflect.get(e,n)},set(e,n,o){return Reflect.get(e,n)},deleteProperty(e,n){return Reflect.get(e,n)}})}function le(t){return t&&Mt(t)[w.IS_READONLY]}const It=new WeakMap,J=new WeakMap,w={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function x(t){if(!_(t)||Object.isFrozen(t)||It.get(t))return t;let e=null;return new Proxy(t,{get(n,o,s){if(o===w.RAW)return n;if(_(n[o]))return x(n[o]);const r=Reflect.get(n,o,s);return ue(n),r},set(n,o,s,r){if(n[w.IS_READONLY])return!0;if(_(n[o])){const a=n[o],p=new Set;for(const h in s)p.add(h),this.set(a,h,s[h],r[o]);for(const h in a)p.has(h)||this.deleteProperty(a,h);return!0}if(Reflect.get(n,o,r)===s)return!0;const u=Reflect.set(n,o,s,r),f=J.get(n)||new Set;f.add(o);const m=f.size;return J.set(n,f),b(()=>{const a=Reflect.get(n,o,r);u&&a===s&&m===1&&wt(n),J.delete(n)}),u},deleteProperty(n,o){const s=Reflect.get(n,o);if(_(s)){for(const u in s)this.deleteProperty(s,u);return!0}const r=ce(n,o),c=Reflect.deleteProperty(n,o);return e=o,b(()=>{r&&c&&s!==void 0&&o===e&&(wt(n),e=null)}),c}})}function it(t){return!!t[w.RAW]}function fe(t){return it(t)?t[w.RAW]:t}function ae(t){return it(t)||le(t)}function pe(t){return _(t)&&It.set(t,!0),t}function Ft(t){const e=x({value:t});function n(){return e.value}function o(s){e.value=s}return[n,o]}const ut="__v_isRef";var ln;class Lt{constructor(e){l(this,ln,!0);l(this,"__v_isShallow",!1);l(this,"_rawValue");l(this,"_value");l(this,"getSignal");l(this,"setSignal");this._rawValue=e;const[n,o]=Ft(e);this.getSignal=n,this.setSignal=o,this._value=n()}get value(){return this.getSignal()}set value(e){this.setSignal(e),this._rawValue=e}}ln=ut;function Q(t){return new Lt(t)}function Vt(t){return t&&!!t[ut]}function he(t){return Vt(t)?t.value:t}class Bt{constructor(e,n,o=void 0){l(this,"__v_isRef",!0);l(this,"_defaultValue");l(this,"_key");l(this,"_object");this._defaultValue=o,this._key=n,this._object=e}get value(){return this._object[this._key]}set value(e){this._object[this._key]=e}}function de(t,e,n=void 0){return new Bt(t,e,n)}function ge(t){const e={};for(const n in t)e[n]=new Bt(t,n);return e}class me extends Lt{constructor(n){let o=!1;const{get:s,set:r}=n(()=>o=!0,()=>this.setValue());super(s());l(this,"_get");l(this,"_set");this.__v_isRef=o,this._get=s,this._set=r}get value(){return this.__v_isRef?super.value:this._get()}set value(n){this._set(n)}setValue(){super.value=this._get()}}function ye(t){return new me(t)}class _e{constructor(e){l(this,"fn");this.fn=e}}var fn;class St{constructor(e,n){l(this,"__v_isReadonly",!0);l(this,fn,!0);l(this,"_cacheable",!0);l(this,"_dirty",!0);l(this,"computed");l(this,"_setter");this.computed=new _e(e),this._setter=n}get value(){return this.computed.fn()}set value(e){this._setter&&this._setter(e)}}fn=ut;function $t(t){return typeof t=="function"?new St(t):new St(t.get,t.set)}const k=function(){const t=new WeakMap,e=["null","weakset","weakmap"],n={set(o){const s=new Set;for(const r of o)s.add(k(r));return s},map(o){const s=new Map;for(const[r,c]of o.entries())s.set(r,k(c));return s}};return function(o){const s=st(o);if(typeof o!="object"||e.includes(s))return o;if(t.has(o))return t.get(o);if(n[s])return n[s](o);const r=I(o)?[]:{};Object.setPrototypeOf(r,Object.getPrototypeOf(o)),t.set(o,r);for(const c in o)r[c]=k(o[c]);return r}}();function P(t,e){return Object.assign({},t,e)}function lt(t,e,n={}){let o=!1;if(o)return;const s=t();n.immediate&&e(s,void 0);let r=k(s);return O(()=>{const c=t();if(_(c)&&n.deep){ct(c,r)||(e(c,r),r=k(c));return}c!==r&&(e(c,r),r=c)}),()=>{o=!0}}function be(t){let e=!1,n=!1;return O(()=>{if(e)return!0;t(o=>{n&&o(),n=!0})}),()=>{e=!0}}function C(t){return["string","number"].includes(typeof t)&&t!==""}function Ut(t){return!/^on/.test(t)}function ft(t){return g(t)&&(Y(t.tag)||T(t.tag))}function d(t){return typeof t=="function"&&!T(t)}function at(t){return[void 0,null,"",!0,!1].includes(t)}function F(t){return document.createTextNode(t)}function i(t,e,...n){const o={tag:t,attrs:e||{},children:n};return d(o.tag)&&o.children.length===0&&o.attrs.children&&(o.children=o.attrs.children),o}function L({children:t}){return t}const W=Symbol("Fragment");L.prototype[W]=W;function T(t){return typeof t=="function"&&t.prototype[W]===W}let V=!1;function Et(t){V=t}const X=[];let Dt=!1;function Re(t){if(!V){if(Dt){b(t);return}X.push(t)}}function jt(){X.forEach(t=>{t()}),X.length=0,Dt=!0}const Wt=new WeakMap;function qt(t,e=[]){return t.forEach(n=>{g(n)&&(d(n.tag)?e.push({comp:n.tag,compId:n.tag.prototype._id,props:P(n.attrs,{children:t})}):C(n.tag)&&qt(n.children,e))}),e}function pt(t,e=[]){const n=Wt.get(t)||[];return e.push(...n),n.forEach(o=>{const s=pt(o.comp);e.push(...s)}),e}const Z=new Map;function we(t,e){if(V)return;const n=t.prototype._id,o=Z.get(n)||[];o.some(r=>r===e)||(o.push(e),Z.set(n,o))}function kt(t){const e=pt(t).map(o=>o.compId);e.unshift(t.prototype._id);const n=[];e.forEach(o=>{const s=Z.get(o)||[];n.push(...s)}),n.forEach(o=>{o()})}const tt=[];let vt=!1;function Se(t){if(!V){if(vt){t();return}tt.push(t)}}function Ee(){tt.forEach(t=>{t()}),tt.length=0,vt=!0}const et=new Map;function je(t,e){if(V)return;const n=t.prototype._id,o=et.get(n)||[];o.some(r=>r===e)||(o.push(e),et.set(n,o))}function Nt(t){const e=pt(t).map(o=>o.compId);e.unshift(t.prototype._id);const n=[];e.forEach(o=>{const s=et.get(o)||[];n.push(...s)}),n.forEach(o=>{o()})}function S(t,e,n){if(Y(t))return ht(t,e,n);if(T(t))return q(n);if(d(t)){const o=P(e,{children:n});t.prototype._id=ie();const s=t(o);return C(s)?F(s):(Wt.set(t,qt(s.children)),S(s.tag,s.attrs,s.children))}}function ht(t,e={},n=[""]){if(T(t))return S(t,e,n);const o=document.createElement(t);n.forEach(s=>{if(!at(s)){if(C(s)){const r=F(s);r.nodeValue=s,o.appendChild(r);return}if(typeof s=="function"){const r=q([s]);o.appendChild(r);return}if(I(s)){const r=q(s);o.appendChild(r);return}if(ft(s)){const r=ht(s.tag,s.attrs,s.children);o.appendChild(r);return}if(g(s)&&d(s.tag)){const r=S(s.tag,s.attrs,s.children);o.appendChild(r);return}}});for(const s in e){const r=e[s];o[s]=r,s==="ref"&&(r.value=o),typeof r=="function"&&Ut(s)&&O(()=>{o[s]=r()})}if(e.style&&g(e.style))for(const s in e.style){const r=e.style[s];typeof r=="function"?O(()=>o.style[s]=r()):o.style[s]=r}return o}function q(t){const e=document.createDocumentFragment();return t.forEach(n=>{if(!at(n)){if(C(n)){const o=F(n);o.nodeValue=n,e.appendChild(o);return}if(typeof n=="function"){ke(e,n);return}if(I(n)){const o=q(n);e.appendChild(o);return}if(ft(n)){const o=ht(n.tag,n.attrs,n.children);e.appendChild(o);return}if(g(n)&&d(n.tag)){const o=S(n.tag,n.attrs,n.children);e.appendChild(o);return}}}),e}function Ot(t){if(C(t))return F(t);if(ft(t)||g(t)&&d(t.tag))return S(t.tag,t.attrs,t.children)}function ke(t,e){let n=[],o=!0,s=null;const r=F("");t.appendChild(r),O(()=>{let c=e();if(c&&g(c)&&T(c.tag))return;I(c)||(c=[c]),c=c.filter(f=>!at(f));let u=0;for(;u<c.length;){let f=c[u];const m=u,a=n.findIndex(p=>p.key===m);if(a>=0){if(ct(f,n[a].tree)){u++;continue}const p=Ot(f);if(!p){c.splice(a,1),u++;continue}const h=n[a].tree;d(h.tag)&&Nt(h.tag),n[a].node.parentElement.replaceChild(p,n[a].node),d(h.tag)&&kt(h.tag),n[a].tree=f,n[a].node=p}else{const p=Ot(f);if(!p){u++;continue}if(o)t.appendChild(p);else if(n.length===0)s??(s=r.parentElement),s.insertBefore(p,r.nextSibling);else{const h=n[n.length-1].node,ne=h.nextSibling;h.parentElement.insertBefore(p,ne)}n.push({key:m,tree:f,node:p})}u++}if(n.length>c.length){for(let f=c.length;f<n.length;f++){const m=n[f].tree;d(m.tag)&&Nt(m.tag),n[f].node.remove(),d(m.tag)&&kt(m.tag)}n.splice(c.length,n.length-c.length)}o=!1})}function dt(t,e={},n=[""]){if(T(t)){const r=P(e,{children:n}),c=t(r);return v(c)}if(d(t)){const r=P(e,{children:n}),c=t(r);return dt(c.tag,c.attrs,c.children)}let o="";for(const r in e){if(r.startsWith("on")||r==="ref")continue;let c=typeof e[r]=="function"&&Ut(r)?e[r]():e[r];if(r==="className"){o+=` class=${c}`;continue}if(r==="style"&&g(c)){for(const u in c)typeof c[u]=="function"&&(c[u]=c[u]());c='"'+JSON.stringify(c).slice(1,-1).replaceAll('"',"").replaceAll(",",";")+'"'}o+=` ${r}=${c}`}const s=v(n);return`<${t}${o}>${s}</${t}>`}function v(t){let e="";return t.forEach(n=>{if(C(n)){e+=n.toString();return}if(I(n)){e+=v(n);return}if(typeof n=="function"){const o=n();e+=v([o]);return}if(g(n)){e+=dt(n.tag,n.attrs,n.children);return}}),e}function Ne({tag:t,attrs:e,children:n}){const o=S(t,e,n);if(Ee(),o instanceof DocumentFragment){const s=o.children[0];b(()=>{s.parentNode&&jt()})}else o instanceof HTMLElement&&b(()=>{o.parentNode&&jt()});return o}function Ht({tag:t,attrs:e,children:n}){Et(!0);const o=dt(t,e,n);return Et(!1),o}const Oe=Object.freeze(Object.defineProperty({__proto__:null,Fragment:L,binding:O,computed:$t,createSignal:Ft,customRef:ye,h:i,isProxy:ae,isReactive:it,isRef:Vt,markRaw:pe,nextTick:b,onBeforeMount:Se,onBeforeUnmount:je,onMounted:Re,onUnmounted:we,reactive:x,readonly:Mt,ref:Q,render:Ne,renderToString:Ht,toRaw:fe,toRef:de,toRefs:ge,unref:he,watch:lt,watchEffect:be},Symbol.toStringTag,{value:"Module"}));let R="",E,gt=!0,nt="";function Kt(t){R=t.base||"/",E=t.mode||"history",gt=t.isBrowser??!0,nt=t.SSR_DATA_KEY||"g_initialProps"}function mt(t){if(Y(t))return t;t=t;const e=t.path;let n="";for(const r in t.query)n+=`&${r}=${t.query[r]}`;n=n?"?"+n:"";const o=t.hash?"#"+t.hash:"";return e+n+o}function Pe(t){const e={};return t.replace("?","").split("&").forEach(o=>{const[s,r]=o.split("=");s&&r&&(e[s]=r)}),e}function B(t){return t.replace(/\/+/g,"/")}const N=x({path:"",query:{},hash:"",meta:{}});function A(t){const e=new URL(B("http://0.0.0.0/"+t));N.path=e.pathname.replace(R,"/"),N.query=Pe(e.search),N.hash=e.hash}function Ae(){if(!N.path&&gt){let t="";E==="history"?t=location.href.replace(location.origin+R,""):t=location.hash.slice(1),A(t)}return N}function xe(t){const e=mt(t);E==="history"?history.pushState({},"",B(R+"/"+e)):location.hash=e,A(e)}function Ce(t){const e=mt(t);E==="history"?history.replaceState({},"",B(R+"/"+e)):location.hash=e,A(e)}function Te(t){history.go(t)}function Yt(){return{push:xe,replace:Ce,go:Te}}function yt(t){t.exact??(t.exact=!0);const e=t.component;return i(e,null)}const H=Symbol("Route");yt.prototype[H]=H;function ot(t){return typeof t=="function"&&t.prototype[H]===H}function Me(t){return i("div",null)}function zt(t,e){const n=t.find(r=>r.attrs.exact||r.attrs.exact===void 0?e===r.attrs.path:(e+"/").startsWith(B(r.attrs.path+"/")));if(!n)return null;const o={tag:"",attrs:{},children:[]};o.tag=n.attrs.component;const s=[zt(n.children,e)].filter(r=>r);if(o.children=s,s.length===0){const r=n.children[n.children.length-1];r&&ot(r.tag)&&!r.attrs.path&&(o.children=[P(o,{tag:r.attrs.component})])}if(n.attrs.exact===!1&&o.children.length===0){const r=t[t.length-1];if(r&&ot(r.tag)&&!r.attrs.path)return o.tag=r.attrs.component,o}return o}let Pt=!0;function Jt(t,e=!0){const n=x({tag:"",attrs:{},children:[]});return lt(()=>N.path,async o=>{const s=t.children.filter(c=>g(c)&&ot(c.tag)),r=zt(s,o);if(r){e&&typeof r.tag.prototype.getInitialProps=="function"&&(Pt&&window[nt]?(delete window[nt],Pt=!1):t.Loading&&(n.tag=t.Loading));for(const c in r)n[c]=r[c]}},{immediate:!0}),{currentTree:n}}function Gt(t){const e=t(),n=e.tag;return i(L,null,()=>i(n,null,e.children[0]&&Gt(()=>e.children[0])))}function Ie(t){function e(){return E==="history"?location.href.replace(location.origin+R,""):location.hash.slice(1)}A(e()),window.addEventListener("popstate",()=>{A(e())});const{currentTree:n}=Jt(t);return Gt(()=>n)}function Fe(t){let e="";if(E==="history")e=t.url.replace(R,"");else{const o=t.url.match(/#.*/);e=o?o[0]:""}A(e);const{currentTree:n}=Jt({children:t.children,url:e},!1);return i("tier",{tree:()=>n})}function Qt(t){return i(L,null,gt?i(Ie,{...t}):i(Fe,{...t}))}const Le={to:"/",type:"push"};function U(t){t=P(Le,t);const e=Y(t.to)?t.to:mt(t.to),n=B(R+(E==="hash"?"#"+e:e)),o=Yt();function s(r){r.preventDefault(),t.type==="push"?o.push(e):o.replace(e)}return i("a",{href:n,onclick:s},t.children)}const Ve=Object.freeze(Object.defineProperty({__proto__:null,Link:U,Redirect:Me,Route:yt,Router:Qt,initRouter:Kt,useRoute:Ae,useRouter:Yt},Symbol.toStringTag,{value:"Module"}));function Be(t,e=0){return Math.floor(Math.random()*(t-e)+e)}function $e(t="000000",e="ffffff"){const n=parseInt(t,16),o=parseInt(e,16);return"#"+Be(o,n).toString(16)}const rt={"text/html":[".html"],"text/css":[".css"],"application/javascript;":[".js"],"application/json":[".json"],"image/vnd.microsoft.icon":[".ico"],"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/gif":[".gif"],"application/pdf":[".pdf"],"font/woff2":[".worf2"],"font/woff":[".worf"],"font/ttf":[".ttf"],"application/octet-stream":[".mp4",".avi"]};function Ue(){const t=Object.values(rt).flat();return[".gz"].concat(t)}function De(t){t=t.toLowerCase();let e=null;for(const n in rt)if(rt[n].includes(t)){e=n;break}return e}const We="page-home-9fa45b",qe="red-font-8020a0",At={"page-home":"page-home-9fa45b",pageHome:We,"red-font":"red-font-8020a0",redFont:qe},K=Symbol("action");function ve(t){return typeof t=="function"&&t.prototype[K]===K}var y;class He{constructor(e,n){l(this,"state");l(this,"actions");Rt(this,y,!0);this.state=x(k(e)),lt(()=>this.state,()=>{bt(this,y)&&this._merge(e)},{deep:!0}),this.actions={};for(const o in n){let s=function(...c){j(r,y,!1);const u=n[o](...c);r._merge(e),_(u)&&u[Symbol.toStringTag]==="Promise"?u.then(()=>{r._merge(e),b(()=>j(r,y,!0))}):(r._merge(e),b(()=>j(r,y,!0)))};const r=this;s.prototype[K]=K,this.actions[o]=s}}_merge(e){const n=Object.keys(e);for(const o in e)this.state[o]=e[o];for(const o in this.state)ve(this.state[o])||!n.includes(o)&&delete this.state[o]}get store(){j(this,y,!1);const e=Object.assign(this.state,this.actions);return b(()=>j(this,y,!0)),e}}y=new WeakMap;function Ke(t,e){return()=>new He(t,e).store}const Xt={count:0},Ye={setCount(t){Xt.count=t}},ze=Ke(Xt,Ye);function Zt(t){const e=ze(),n=Q(0),o=Q(null);return i("div",{className:At["page-home"]},i("h1",null,"Store: ",()=>e.count),i("button",{onclick:()=>e.setCount(++e.count)},"Store change"),i("h1",{ref:o},"Ref: count ",i("span",{className:At["red-font"]},()=>n.value)),i("button",{onclick:()=>n.value++},"count++"),i(Je,{count:()=>n.value}),i("h1",null,"Page.getInitialProps: ",t.data))}Zt.prototype.getInitialProps=async()=>new Promise(t=>{setTimeout(()=>{t(123)},300)});function Je(t){const e=$t(()=>$e().slice(0,-1)+t.count().toString().slice(0,1));return i("h1",{style:{color:()=>e.value}},"子组件 ",t.count)}const Ge="page-about-d0f5f3",Qe={"page-about":"page-about-d0f5f3",pageAbout:Ge};function Xe(){return i("div",{className:Qe["page-about"]},i("p",null,"自个儿手写的 Vue 响应式源码，实现个大概！"),i("strong",null,"Vue API"),i("p",null,Object.keys(Oe).join("、")),i("strong",null,"Router API"),i("p",null,Object.keys(Ve).join("、")))}const Ze="not-found-710606",tn={"not-found":"not-found-710606",notFound:Ze};function en(){return i("div",{className:tn["not-found"]},"404")}const nn="header-937207",on="github-211c2b",xt={header:nn,github:on},z={BASE_URL:"/",NODE_ENV:"production",BASE_API:"/api",DEPLOY_URL:"/"},te=[{path:"/",component:Zt,exact:!0},{path:"/about",component:Xe},{component:en}];function rn(t){return Kt({base:z.BASE_URL,mode:"history",isBrowser:t.isBrowser}),i(L,null,i("nav",{className:xt.header},i(U,{to:"/"},"首页"),i(U,{to:"/about"},"关于"),i(U,{to:"/404"},"notFound"),i("a",{className:xt.github,href:"https://github.com/yubo9807/mvvm_vue3",target:"_blank"},"GitHub")),i(Qt,{url:t.url,data:t.data,Loading:sn},...te.map(e=>i(yt,{...e}))))}function sn(){return i("div",null,"loading...")}const ee=z.DEPLOY_URL.slice(1),$=Tt.readFileSync(G.resolve(__dirname,ee,"index.html"),"utf-8");async function cn(t){const e=te.find(n=>n.exact?t===n.path:(t+"/").startsWith(n.path+"/"));if(e&&typeof e.component.prototype.getInitialProps=="function")return await e.component.prototype.getInitialProps()}const un=se.createServer(async(t,e)=>{const n=t.url.replace(z.BASE_URL,"/"),o=G.extname(n);if(Ue().includes(o)){const s=G.resolve(__dirname,ee,n.slice(1));Tt.readFile(s,(r,c)=>{if(r)e.writeHead(404,{"Content-Type":"text/plain"}),e.end("Not Found");else{const u=De(o);u&&e.setHeader("Content-Type",u),e.write(c),e.end()}})}else{const s=await cn(n),r=Ht(i(rn,{isBrowser:!1,url:n,data:s})),c=$.search("</body>"),u=s===void 0?"":`<script>window.g_initialProps=${JSON.stringify(s)}<\/script>`,f=$.slice(0,c)+u+$.slice(c,$.length);e.write(f.replace("<!--ssr-outlet-->",r)),e.end()}}),Ct=3e3;un.listen(Ct,()=>{console.log(`http://localhost:${Ct}${z.BASE_URL}`)});
