"use strict";var ee=Object.defineProperty;var ne=(t,e,n)=>e in t?ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var a=(t,e,n)=>(ne(t,typeof e!="symbol"?e+"":e,n),n),mt=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var yt=(t,e,n)=>(mt(t,e,"read from private field"),n?n.call(t):e.get(t)),_t=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},j=(t,e,n,o)=>(mt(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);const oe=require("http"),xt=require("fs"),X=require("path");function rt(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function y(t){return["object","array"].includes(rt(t))}function re(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function st(t,e){if(y(t)&&y(e)){const n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;for(const r of n)if(!o.includes(r)||!st(t[r],e[r]))return!1;return!0}else return t===e}function p(t){return rt(t)==="object"}function F(t){return Array.isArray(t)}function K(t){return typeof t=="string"}function m(t){Promise.resolve().then(t)}function se(){return Number(Math.random().toString().slice(2)).toString(32)}let I=null;const W=new WeakMap;function O(t){I=t,t(),I=null}function ie(t){const e=W.get(t)||[],n=e.some(o=>I===o);I&&!n&&(e.push(I),W.set(t,e))}function bt(t){const e=W.get(t);e&&e.forEach((n,o)=>{const r=n();typeof r=="boolean"&&r&&(e.splice(o,1),W.set(t,e))})}function Mt(t){return Reflect.defineProperty(t,w.IS_READONLY,{value:!0}),new Proxy(t,{get(e,n){return n===w.RAW?e:Reflect.get(e,n)},set(e,n,o){const r=Reflect.get(e,n);return printWran(`Set operation on key '${n.toString()}' failed: target is readonly.`,{[n.toString()]:r}),r},deleteProperty(e,n){const o=Reflect.get(e,n);return printWran(`Delete operation on key '${n.toString()}' failed: target is readonly.`,{[n.toString()]:o}),o}})}function ce(t){return t&&Mt(t)[w.IS_READONLY]}const It=new WeakMap,w={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function E(t){if(!y(t)||Object.isFrozen(t)||It.get(t))return t;let e=null;return new Proxy(t,{get(n,o,r){if(o===w.RAW)return n;ie(n);const s=Reflect.get(n,o,r);return y(s)?E(s):s},set(n,o,r,s){const i=Reflect.get(n,o,s),c=Reflect.set(n,o,r,s);return n[w.IS_READONLY]?i:(m(()=>{const l=Reflect.get(n,o,s);c&&i!==r&&l===r&&bt(n)}),c)},deleteProperty(n,o){Reflect.get(n,o),re(n,o);const r=Reflect.deleteProperty(n,o);return e=o,m(()=>{o===e&&(bt(n),e=null)}),r}})}function it(t){return!!t[w.RAW]}function ue(t){return it(t)?t[w.RAW]:t}function ae(t){return it(t)||ce(t)}function le(t){return y(t)&&It.set(t,!0),t}function Lt(t){const e=E({value:t});function n(){return e.value}function o(r){e.value=r}return[n,o]}const ct="__v_isRef";var cn;class vt{constructor(e){a(this,cn,!0);a(this,"__v_isShallow",!1);a(this,"_rawValue");a(this,"_value");a(this,"getSignal");a(this,"setSignal");this._rawValue=e;const[n,o]=Lt(e);this.getSignal=n,this.setSignal=o,this._value=n()}get value(){return this.getSignal()}set value(e){this.setSignal(e),this._rawValue=e}}cn=ct;function L(t){return new vt(t)}function Ft(t){return t&&!!t[ct]}function fe(t){return Ft(t)?t.value:t}class Tt{constructor(e,n,o=void 0){a(this,"__v_isRef",!0);a(this,"_defaultValue");a(this,"_key");a(this,"_object");this._defaultValue=o,this._key=n,this._object=e}get value(){return this._object[this._key]}set value(e){this._object[this._key]=e}}function pe(t,e,n=void 0){return new Tt(t,e,n)}function he(t){const e={};for(const n in t)e[n]=new Tt(t,n);return e}class de extends vt{constructor(n){let o=!1;const{get:r,set:s}=n(()=>o=!0,()=>this.setValue());super(r());a(this,"_get");a(this,"_set");this.__v_isRef=o,this._get=r,this._set=s}get value(){return this.__v_isRef?super.value:this._get()}set value(n){this._set(n)}setValue(){super.value=this._get()}}function ge(t){return new de(t)}class me{constructor(e){a(this,"fn");this.fn=e}}var un;class Rt{constructor(e,n){a(this,"__v_isReadonly",!0);a(this,un,!0);a(this,"_cacheable",!0);a(this,"_dirty",!0);a(this,"computed");a(this,"_setter");this.computed=new me(e),this._setter=n}get value(){return this.computed.fn()}set value(e){this._setter&&this._setter(e)}}un=ct;function Vt(t){return typeof t=="function"?new Rt(t):new Rt(t.get,t.set)}const S=function(){const t=new WeakMap,e=["null","weakset","weakmap"],n={set(o){const r=new Set;for(const s of o)r.add(S(s));return r},map(o){const r=new Map;for(const[s,i]of o.entries())r.set(s,S(i));return r}};return function(o){const r=rt(o);if(typeof o!="object"||e.includes(r))return o;if(t.has(o))return t.get(o);if(n[r])return n[r](o);const s=F(o)?[]:{};Object.setPrototypeOf(s,Object.getPrototypeOf(o)),t.set(o,s);for(const i in o)s[i]=S(o[i]);return s}}();function v(t,e){return Object.assign({},t,e)}function J(t,e,n={}){let o=!1;if(o)return;const r=t();let s=S(r);return n.immediate&&e(r,void 0),O(()=>{const i=[];if(o)return i.length>0&&i.forEach(l=>l()),!0;const c=t();y(r)?n.deep&&!st(c,s)&&(e(c,E(s)),s=S(c),$t(c).forEach(l=>{const h=J(()=>l,()=>{e(c,E(s))},{deep:!0});i.push(h)})):c!==s&&(e(c,s),s=S(c))}),()=>{o=!0}}function $t(t,e=[]){for(const n in t)y(t[n])&&(e.push(t[n]),$t(t[n],e));return e}function ye(t){let e=!1,n=!1;return O(()=>{if(e)return!0;t(o=>{n&&o(),n=!0})}),()=>{e=!0}}function P(t){return["string","number"].includes(typeof t)&&t!==""}function Bt(t){return!/^on/.test(t)}function ut(t){return p(t)&&(K(t.tag)||M(t.tag))}function f(t){return typeof t=="function"&&!M(t)}function at(t){return[void 0,null,"",!0,!1].includes(t)}function T(t){return document.createTextNode(t)}function u(t,e,...n){const o={tag:t,attrs:e||{},children:n};return f(o.tag)&&o.children.length===0&&o.attrs.children&&(o.children=o.attrs.children),o}function x({children:t}){return t}const D=Symbol("Fragment");x.prototype[D]=D;function M(t){return typeof t=="function"&&t.prototype[D]===D}let V=!1;function St(t){V=t}const Z=[];let Ut=!1;function _e(t){if(!V){if(Ut){m(t);return}Z.push(t)}}function wt(){Z.forEach(t=>{t()}),Z.length=0,Ut=!0}const Wt=new WeakMap;function Dt(t,e=[]){return t.forEach(n=>{p(n)&&(f(n.tag)?e.push({comp:n.tag,compId:n.tag.prototype._id,props:v(n.attrs,{children:t})}):P(n.tag)&&Dt(n.children,e))}),e}function lt(t,e=[]){const n=Wt.get(t)||[];return e.push(...n),n.forEach(o=>{const r=lt(o.comp);e.push(...r)}),e}const tt=new Map;function be(t,e){if(V)return;const n=t.prototype._id,o=tt.get(n)||[];o.some(s=>s===e)||(o.push(e),tt.set(n,o))}function Et(t){const e=lt(t).map(o=>o.compId);e.unshift(t.prototype._id);const n=[];e.forEach(o=>{const r=tt.get(o)||[];n.push(...r)}),n.forEach(o=>{o()})}const et=[];let Ht=!1;function Re(t){if(!V){if(Ht){t();return}et.push(t)}}function Se(){et.forEach(t=>{t()}),et.length=0,Ht=!0}const nt=new Map;function we(t,e){if(V)return;const n=t.prototype._id,o=nt.get(n)||[];o.some(s=>s===e)||(o.push(e),nt.set(n,o))}function kt(t){const e=lt(t).map(o=>o.compId);e.unshift(t.prototype._id);const n=[];e.forEach(o=>{const r=nt.get(o)||[];n.push(...r)}),n.forEach(o=>{o()})}function k(t,e,n){if(K(t))return ft(t,e,n);if(M(t))return H(n);if(f(t)){const o=v(e,{children:n});t.prototype._id=se();const r=t(o);return P(r)?T(r):(Wt.set(t,Dt(r.children)),k(r.tag,r.attrs,r.children))}}function ft(t,e={},n=[""]){if(M(t))return k(t,e,n);const o=document.createElement(t);n.forEach(r=>{if(!at(r)){if(P(r)){const s=T(r);s.nodeValue=r,o.appendChild(s);return}if(typeof r=="function"){const s=H([r]);o.appendChild(s);return}if(F(r)){const s=H(r);o.appendChild(s);return}if(ut(r)){const s=ft(r.tag,r.attrs,r.children);o.appendChild(s);return}if(p(r)&&f(r.tag)){const s=k(r.tag,r.attrs,r.children);o.appendChild(s);return}}});for(const r in e){const s=e[r];o[r]=s,r==="ref"&&(s.value=o),typeof s=="function"&&Bt(r)&&O(()=>{o[r]=s()})}if(e.style&&p(e.style))for(const r in e.style){const s=e.style[r];typeof s=="function"?O(()=>o.style[r]=s()):o.style[r]=s}return o}function H(t){const e=document.createDocumentFragment();return t.forEach(n=>{if(!at(n)){if(P(n)){const o=T(n);o.nodeValue=n,e.appendChild(o);return}if(typeof n=="function"){Ee(e,n);return}if(F(n)){const o=H(n);e.appendChild(o);return}if(ut(n)){const o=ft(n.tag,n.attrs,n.children);e.appendChild(o);return}if(p(n)&&f(n.tag)){const o=k(n.tag,n.attrs,n.children);e.appendChild(o);return}}}),e}function Ct(t){if(P(t))return T(t);if(ut(t)||p(t)&&f(t.tag))return k(t.tag,t.attrs,t.children)}function Ee(t,e){let n=[],o=!0,r=null;const s=T("");t.appendChild(s),O(()=>{let i=e();if(i&&p(i)&&M(i.tag))return;F(i)||(i=[i]),i=i.filter(l=>!at(l));let c=0;for(;c<i.length;){let l=i[c];const h=c,b=n.findIndex(d=>d.key===h);if(b>=0){if(st(l,n[b].tree)){c++;continue}const d=Ct(l),R=n[b].tree;f(R.tag)&&kt(R.tag),n[b].node.parentElement.replaceChild(d,n[b].node),f(R.tag)&&Et(R.tag),n[b].tree=l,n[b].node=d}else{const d=Ct(l);if(o)t.appendChild(d);else if(n.length===0)r??(r=s.parentElement),r.insertBefore(d,s.nextSibling);else{const R=n[n.length-1].node,te=R.nextSibling;R.parentElement.insertBefore(d,te)}n.push({key:h,tree:l,node:d})}c++}if(n.length>i.length){for(let l=i.length;l<n.length;l++){const h=n[l].tree;f(h.tag)&&kt(h.tag),n[l].node.remove(),f(h.tag)&&Et(h.tag)}n.splice(i.length,n.length-i.length)}o=!1})}function pt(t,e={},n=[""]){if(M(t)){const s=v(e,{children:n}),i=t(s);return q(i)}if(f(t)){const s=v(e,{children:n}),i=t(s);return pt(i.tag,i.attrs,i.children)}let o="";for(const s in e){if(s.startsWith("on")||s==="ref")continue;let i=typeof e[s]=="function"&&Bt(s)?e[s]():e[s];if(s==="className"){o+=` class=${i}`;continue}if(s==="style"&&p(i)){for(const c in i)typeof i[c]=="function"&&(i[c]=i[c]());i='"'+JSON.stringify(i).slice(1,-1).replaceAll('"',"").replaceAll(",",";")+'"'}o+=` ${s}=${i}`}const r=q(n);return`<${t}${o}>${r}</${t}>`}function q(t){let e="";return t.forEach(n=>{if(P(n)){e+=n.toString();return}if(F(n)){e+=q(n);return}if(typeof n=="function"){const o=n();e+=q([o]);return}if(p(n)){e+=pt(n.tag,n.attrs,n.children);return}}),e}function ke({tag:t,attrs:e,children:n}){const o=k(t,e,n);if(Se(),o instanceof DocumentFragment){const r=o.children[0];m(()=>{r.parentNode&&wt()})}else o instanceof HTMLElement&&m(()=>{o.parentNode&&wt()});return o}function qt({tag:t,attrs:e,children:n}){St(!0);const o=pt(t,e,n);return St(!1),o}const Ce=Object.freeze(Object.defineProperty({__proto__:null,Fragment:x,binding:O,computed:Vt,createSignal:Lt,customRef:ge,h:u,isProxy:ae,isReactive:it,isRef:Ft,markRaw:le,nextTick:m,onBeforeMount:Re,onBeforeUnmount:we,onMounted:_e,onUnmounted:be,reactive:E,readonly:Mt,ref:L,render:ke,renderToString:qt,toRaw:ue,toRef:pe,toRefs:he,unref:fe,watch:J,watchEffect:ye},Symbol.toStringTag,{value:"Module"}));let _="",C,ht=!0,B="";function Yt(t){_=t.base||"/",C=t.mode||"history",ht=t.isBrowser??!0,B=t.SSR_DATA_KEY||"g_initialProps"}function dt(t){if(K(t))return t;t=t;const e=t.path;let n="";for(const s in t.query)n+=`&${s}=${t.query[s]}`;n=n?"?"+n:"";const o=t.hash?"#"+t.hash:"";return e+n+o}function je(t){const e={};return t.replace("?","").split("&").forEach(o=>{const[r,s]=o.split("=");r&&s&&(e[r]=s)}),e}function G(t){return t.replace(/\/+/g,"/")}const N=E({path:"",query:{},hash:"",meta:{}});function A(t){const e=new URL(G("http://0.0.0.0/"+t));N.path=e.pathname.replace(_,"/"),N.query=je(e.search),N.hash=e.hash}function Ne(){if(!N.path&&ht){let t="";C==="history"?t=location.href.replace(location.origin+_,""):t=location.hash.slice(1),A(t)}return N}function Oe(t){const e=dt(t);C==="history"?history.pushState({},"",G(_+"/"+e)):location.hash=e,A(e)}function Ae(t){const e=dt(t);C==="history"?history.replaceState({},"",G(_+"/"+e)):location.hash=e,A(e)}function Pe(t){history.go(t)}function zt(){return{push:Oe,replace:Ae,go:Pe}}function gt(t){const e=t.component;return u(e,null)}const Y=Symbol("Route");gt.prototype[Y]=Y;function jt(t){return typeof t=="function"&&t.prototype[Y]===Y}function xe(t){return u("div",null)}let Nt=!0;function Kt(t,e=!0){const n=L(null),o=L(void 0);return J(()=>N.path,async r=>{const s=t.children.filter(c=>p(c)&&jt(c.tag)),i=s.find(c=>c.attrs.exact?r===c.attrs.path:(r+"/").startsWith(c.attrs.path+"/"));if(i)if(e){const c=i.attrs.component;typeof c.prototype.getInitialProps=="function"?Nt&&window[B]?(o.value=window[B],delete window[B],Nt=!1):(t.Loading&&(n.value=t.Loading),o.value=await c.prototype.getInitialProps()):o.value=void 0,n.value=c}else n.value=i.attrs.component;else{const c=s[s.length-1];p(c)&&jt(c.tag)&&!c.attrs.path?n.value=c.attrs.component:n.value=null}},{immediate:!0}),{CurrentComp:n,data:o}}function Me(t){function e(){return C==="history"?location.href.replace(location.origin+_,""):location.hash.slice(1)}A(e()),window.addEventListener("popstate",()=>{A(e())});const{CurrentComp:n,data:o}=Kt(t);return u(x,null,()=>n.value?u(n.value,{data:o.value}):null)}function Ie(t){let e="";if(C==="history")e=t.url.replace(_,"");else{const o=t.url.match(/#.*/);e=o?o[0]:""}A(e);const{CurrentComp:n}=Kt({children:t.children,url:e},!1);return u(x,null,()=>u(n.value,{data:t.data}))}function Jt(t){return u(x,null,ht?u(Me,{...t}):u(Ie,{...t}))}const Le={to:"/",type:"push"};function U(t){t=v(Le,t);const e=K(t.to)?t.to:dt(t.to),n=G(_+(C==="hash"?"#"+e:e)),o=zt();function r(s){s.preventDefault(),t.type==="push"?o.push(e):o.replace(e)}return u("a",{href:n,onclick:r},t.children)}const ve=Object.freeze(Object.defineProperty({__proto__:null,Link:U,Redirect:xe,Route:gt,Router:Jt,initRouter:Yt,useRoute:Ne,useRouter:zt},Symbol.toStringTag,{value:"Module"}));function Fe(t,e=0){return Math.floor(Math.random()*(t-e)+e)}function Te(t="000000",e="ffffff"){const n=parseInt(t,16),o=parseInt(e,16);return"#"+Fe(o,n).toString(16)}const ot={"text/html":[".html"],"text/css":[".css"],"application/javascript;":[".js"],"application/json":[".json"],"image/vnd.microsoft.icon":[".ico"],"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/gif":[".gif"],"application/pdf":[".pdf"],"font/woff2":[".worf2"],"font/woff":[".worf"],"font/ttf":[".ttf"],"application/octet-stream":[".mp4",".avi"]};function Ve(){const t=Object.values(ot).flat();return[".gz"].concat(t)}function $e(t){t=t.toLowerCase();let e=null;for(const n in ot)if(ot[n].includes(t)){e=n;break}return e}const Be="page-home-9fa45b",Ue="red-font-8020a0",Ot={"page-home":"page-home-9fa45b",pageHome:Be,"red-font":"red-font-8020a0",redFont:Ue},z=Symbol("action");function We(t){return typeof t=="function"&&t.prototype[z]===z}var g;class De{constructor(e,n){a(this,"state");a(this,"actions");_t(this,g,!0);this.state=E(S(e)),J(()=>this.state,()=>{yt(this,g)&&this._merge(e)},{deep:!0}),this.actions={};for(const o in n){let r=function(...i){j(s,g,!1);const c=n[o](...i);s._merge(e),y(c)&&c[Symbol.toStringTag]==="Promise"?c.then(()=>{s._merge(e),m(()=>j(s,g,!0))}):(s._merge(e),m(()=>j(s,g,!0)))};const s=this;r.prototype[z]=z,this.actions[o]=r}}_merge(e){const n=Object.keys(e);for(const o in e)this.state[o]=e[o];for(const o in this.state)We(this.state[o])||!n.includes(o)&&delete this.state[o]}get store(){j(this,g,!1);const e=Object.assign(this.state,this.actions);return m(()=>j(this,g,!0)),e}}g=new WeakMap;function He(t,e){return()=>new De(t,e).store}const Gt={count:0},qe={setCount(t){Gt.count=t}},Ye=He(Gt,qe);function Qt(t){const e=Ye(),n=L(0),o=L(null);return u("div",{className:Ot["page-home"]},u("h1",null,"Store: ",()=>e.count),u("button",{onclick:()=>e.setCount(++e.count)},"Store change"),u("h1",{ref:o},"Ref: count ",u("span",{className:Ot["red-font"]},()=>n.value)),u("button",{onclick:()=>n.value++},"count++"),u(ze,{count:()=>n.value}),u("h1",null,"Page.getInitialProps: ",t.data))}Qt.prototype.getInitialProps=async()=>new Promise(t=>{setTimeout(()=>{t(123)},300)});function ze(t){const e=Vt(()=>Te().slice(0,-1)+t.count().toString().slice(0,1));return u("h1",{style:{color:()=>e.value}},"子组件 ",t.count)}const Ke="page-about-d0f5f3",Je={"page-about":"page-about-d0f5f3",pageAbout:Ke};function Ge(){return u("div",{className:Je["page-about"]},u("p",null,"自个儿手写的 Vue 响应式源码，实现个大概！"),u("strong",null,"Vue API"),u("p",null,Object.keys(Ce).join("、")),u("strong",null,"Router API"),u("p",null,Object.keys(ve).join("、")))}const Qe="not-found-710606",Xe={"not-found":"not-found-710606",notFound:Qe};function Ze(){return u("div",{className:Xe["not-found"]},"404")}const tn="header-937207",en="github-211c2b",At={header:tn,github:en},Q={BASE_URL:"/",NODE_ENV:"production",BASE_API:"/api",DEPLOY_URL:"/"},Xt=[{path:"/",component:Qt,exact:!0},{path:"/about",component:Ge},{component:Ze}];function nn(t){return Yt({base:Q.BASE_URL,mode:"history",isBrowser:t.isBrowser}),u(x,null,u("nav",{className:At.header},u(U,{to:"/"},"首页"),u(U,{to:"/about"},"关于"),u(U,{to:"/404"},"notFound"),u("a",{className:At.github,href:"https://github.com/yubo9807/mvvm_vue3",target:"_blank"},"GitHub")),u(Jt,{url:t.url,data:t.data,Loading:on},...Xt.map(e=>u(gt,{...e}))))}function on(){return u("div",null,"loading...")}const Zt=Q.DEPLOY_URL.slice(1),$=xt.readFileSync(X.resolve(__dirname,Zt,"index.html"),"utf-8");async function rn(t){const e=Xt.find(n=>n.exact?t===n.path:(t+"/").startsWith(n.path+"/"));if(e&&typeof e.component.prototype.getInitialProps=="function")return await e.component.prototype.getInitialProps()}const sn=oe.createServer(async(t,e)=>{const n=t.url.replace(Q.BASE_URL,"/"),o=X.extname(n);if(Ve().includes(o)){const r=X.resolve(__dirname,Zt,n.slice(1));xt.readFile(r,(s,i)=>{if(s)e.writeHead(404,{"Content-Type":"text/plain"}),e.end("Not Found");else{const c=$e(o);c&&e.setHeader("Content-Type",c),e.write(i),e.end()}})}else{const r=await rn(n),s=qt(u(nn,{isBrowser:!1,url:n,data:r})),i=$.search("</body>"),c=r===void 0?"":`<script>window.g_initialProps=${JSON.stringify(r)}<\/script>`,l=$.slice(0,i)+c+$.slice(i,$.length);e.write(l.replace("<!--ssr-outlet-->",s)),e.end()}}),Pt=3e3;sn.listen(Pt,()=>{console.log(`http://localhost:${Pt}${Q.BASE_URL}`)});
