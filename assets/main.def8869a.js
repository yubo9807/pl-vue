(()=>{"use strict";function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(t){return["object","array"].includes(e(t))}function n(e,t){if("object"==typeof e&&"object"==typeof t){const r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(const c of r){if(!o.includes(c))return!1;if(!n(e[c],t[c]))return!1}return!0}return e===t}let r=null;const o=new WeakMap;function c(e){r=e,e(),r=null}function i(e){const t=o.get(e);t&&t.forEach(((n,r)=>{const c=n();"boolean"==typeof c&&c&&(t.splice(r,1),o.set(e,t))}))}const l=new WeakMap,s={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function a(e){return!t(e)||l.get(e)?e:new Proxy(e,{get(e,n,c){if(n===s.RAW)return e;!function(e){const t=o.get(e)||[],n=t.some((e=>r===e));r&&!n&&t.push(r),o.set(e,t)}(e);const i=Reflect.get(e,n,c);return t(i)?a(i):i},set(e,t,n,r){const o=Reflect.get(e,t,r),c=Reflect.set(e,t,n,r);return e[s.IS_READONLY]?o:(c&&o!==n&&i(e),c)},deleteProperty(e,t){const n=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(e,t),r=Reflect.deleteProperty(e,t);return n&&r&&i(e),r}})}class u{__v_isRef=!0;__v_isShallow=!1;_rawValue;_value;constructor(e){this._rawValue=e,this._value=t(e)?a(e):a({value:e})}get value(){return t(this._rawValue)?this._value:this._value.value}set value(e){this._rawValue=e,t(e)?this._value=e:this._value.value=e}}function f(e,t,...n){return{tag:e,attrs:t||{},children:n}}function d({children:e}){return e}const h=Symbol("Fragment");function p(e){return"function"==typeof e&&e.prototype[h]===h}function g(e){return["string","number"].includes(typeof e)&&""!==e}function y(e){return["className","innerHTML","innerText","textContent"].includes(e)}function b(t){return"object"===e(t)&&("string"==typeof t.tag||p(t.tag))}function m(e){return"function"==typeof e&&!p(e)}d.prototype[h]=h;let v=!1;function _(e){v=e}function j(t,n){v=!0;const r=t();r&&"object"===e(r)&&r.children.forEach((e=>{if(m(e.tag)){const{tag:t,attrs:r,children:o}=e,c=Object.assign({},r,{children:o});n((()=>t(c)))}})),v=!1}const w=[];let O=!1;function E(){w.forEach((e=>{e()})),w.length=0,O=!0}const C=new WeakMap;function N(e){(C.get(e)||[]).forEach((e=>e())),C.delete(e),j(e,N)}const S=[];let x=!1;const A=new WeakMap;function k(e){(A.get(e)||[]).forEach((e=>e())),A.delete(e),j(e,k)}function T(e){if(void 0!==typeof Promise)Promise.resolve().then(e);else if(void 0!==typeof MutationObserver){const t=new MutationObserver(e),n=document.createTextNode("0");t.observe(n,{characterData:!0}),n.data="1"}else void 0!==typeof process?process.nextTick(e):setTimeout(e,0)}function R(t){return t instanceof Array?function(e){let t=new Array(e.length);for(let n=0;n<t.length;n++)t[n]=R(e[n]);return t}(t):"object"===e(t)?function(e){let t={},n=Object.getOwnPropertyNames(e);for(let r=0;r<n.length;r++)t[n[r]]=R(e[n[r]]);return t}(t):t}function $(t,n={},r=[]){if("function"==typeof t&&!p(t)){const e=t(R(Object.assign({},n,{children:r})));return $(e.tag,e.attrs,e.children)}const o=[];return r.forEach((t=>{if("object"===e(t)){const e=$(t.tag,t.attrs,t.children);o.push(e)}else o.push(t)})),{tag:t,attrs:n,children:o}}function M(e,t,n){if("string"==typeof e)return P(e,t,n);if(p(e))return W(n);if(m(e)){const r=e(Object.assign({},t,{children:n}));return M(r.tag,r.attrs,r.children)}}function P(t,n={},r=[""]){if(p(t))return M(t,n,r);const o=document.createElement(t);r.forEach((t=>{if(g(t)){const e=document.createTextNode(t);return e.nodeValue=t,void o.appendChild(e)}if("function"!=typeof t)if(t instanceof Array){const e=W(t);o.appendChild(e)}else if(b(t)){const e=P(t.tag,t.attrs,t.children);o.appendChild(e)}else if("object"===e(t)&&m(t.tag)){const e=V(t);o.appendChild(e)}else console.warn(`render: 不支持 ${t} 值渲染`);else{const e=W([t]);o.appendChild(e)}}));for(const e in n){const t=n[e];o[e]=t,"ref"===e&&(t.value=o),"function"==typeof t&&y(e)&&c((()=>{o[e]=t()}))}if(n.style&&n.style instanceof Object)for(const e in n.style){const t=n.style[e];"function"==typeof t?c((()=>o.style[e]=t())):o.style[e]=t}return o}function W(t){const r=document.createDocumentFragment();return t.forEach((t=>{if(g(t)){const e=document.createTextNode(t);return e.nodeValue=t,void r.appendChild(e)}if("function"==typeof t){let o=[],i=!0,l=null;const s=document.createTextNode("");return r.appendChild(s),void c((()=>{let c=t();if(c&&e(c)&&p(c.tag))return void console.warn("不支持响应式节点片段渲染");c instanceof Array||(c=[c].filter((e=>e)));let a=0;for(;a<c.length;){const e=c[a],t=a,u=o.findIndex((e=>e.key===t));if(u>=0){if(n(e,o[u].tree)){a++;continue}const t=V(e),{tag:r,attrs:c,children:i}=o[u].tree,l=Object.assign({},c,{children:i});m(r)&&k((()=>r(l))),o[u].node.parentElement.replaceChild(t,o[u].node),m(r)&&N((()=>r(l))),o[u].tree=e,o[u].node=t}else{const n=V(e);if(i)r.appendChild(n);else if(0===o.length)l??=s.parentElement,l.insertBefore(n,s.nextSibling);else{const e=o[o.length-1].node,t=e.nextSibling;e.parentElement.insertBefore(n,t)}o.push({key:t,tree:e,node:n})}a++}if(o.length>c.length){for(let e=c.length;e<o.length;e++){const{tag:t,attrs:n,children:r}=o[e].tree,c=Object.assign({},n,{children:r});m(t)&&k((()=>t(c))),o[e].node.remove(),m(t)&&N((()=>t(c)))}o.splice(c.length,o.length-c.length)}i=!1}))}if(t instanceof Array){const e=W(t);r.appendChild(e)}else if(b(t)){const e=P(t.tag,t.attrs,t.children);r.appendChild(e)}else if("object"===e(t)&&m(t.tag)){const e=V(t);r.appendChild(e)}else console.warn(`render: 不支持 ${t} 值渲染`)})),r}function V(t){if(g(t))return document.createTextNode(t.toString());if(b(t))return M(t.tag,t.attrs,t.children);if("object"===e(t)&&m(t.tag)){const e=$(t.tag,t.attrs,t.children);return M(e.tag,e.attrs,e.children)}}function D(t,n={},r=[""]){if(p(t))return L(t(Object.assign({},n,{children:r})));if(m(t)){const e=t(Object.assign({},n,{children:r}));return D(e.tag,e.attrs,e.children)}let o="";for(const t in n){if(t.startsWith("on"))continue;let r="function"==typeof n[t]&&y(t)?n[t]():n[t];if("className"!==t){if("style"===t&&"object"===e(r)){for(const e in r)"function"==typeof r[e]&&(r[e]=r[e]());r='"'+JSON.stringify(r).slice(1,-1).replaceAll('"',"").replaceAll(",",";")+'"'}o+=` ${t}=${r}`}else o+=` class=${r}`}return`<${t}${o}>${L(r)}</${t}>`}function L(t){let n="";return t.forEach((t=>{if(g(t))n+=t.toString();else if(t instanceof Array)n+=L(t);else if("function"!=typeof t)e(t)?n+=D(t.tag,t.attrs,t.children):console.warn(`renderToString: 不支持 ${t} 值渲染`);else{const e=t();n+=L([e])}})),n}const I={demo:"demo__bac49"};function B(){const e=new u(1);return f(d,null,"父组件",f("h1",{className:I.demo},(()=>e.value)),f(F,{count:()=>e.value},f("p",null,"插槽1"),f("p",null,"插槽2")),f("button",{onclick:()=>e.value++},"click"))}function F(e){return f("div",null,f("p",null,"子组件"),f("p",null,"props: ",e.count),f("p",null,e.children))}console.log(function({tag:e,attrs:t,children:n}){_(!0);const r=D(e,t,n);return _(!1),r}(f(B,null))),document.getElementById("root").appendChild(function({tag:e,attrs:t,children:n}){const r=M(e,t,n);if(S.forEach((e=>{e()})),S.length=0,x=!0,r instanceof DocumentFragment){const e=r.children[0];T((()=>{e.parentNode&&E()}))}else r instanceof HTMLElement&&T((()=>{r.parentNode&&E()}));return r}(f(B,null)))})();