var J=Object.defineProperty;var Q=(e,r,t)=>r in e?J(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var h=(e,r,t)=>(Q(e,typeof r!="symbol"?r+"":r,t),t);function z(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function y(e){return["object","array"].includes(z(e))}function X(e,r){return Object.prototype.hasOwnProperty.call(e,r)}function L(e,r){if(y(e)&&y(r)){const t=Object.keys(e),n=Object.keys(r);if(t.length!==n.length)return!1;for(const o of t)if(!n.includes(o)||!L(e[o],r[o]))return!1;return!0}else return e===r}function g(e){return z(e)==="object"}function O(e){return Array.isArray(e)}function U(e){return typeof e=="string"}function N(e){Promise.resolve().then(e)}function Z(){return Number(Math.random().toString().slice(2)).toString(32)}function C(...e){console.warn(...e)}let b=null;const _=new WeakMap;function j(e){b=e,e(),b=null}function v(e){const r=_.get(e)||[],t=r.some(n=>b===n);b&&!t&&(r.push(b),_.set(e,r))}function T(e){const r=_.get(e);r&&r.forEach((t,n)=>{t()===!0&&(r.splice(n,1),_.set(e,r))})}const ee=new WeakMap,M=new WeakMap,k={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function Y(e){if(!y(e)||Object.isFrozen(e))return C(`lue cannot be made reactive: ${e}`),e;if(ee.get(e))return e;let r=null;return new Proxy(e,{get(t,n,o){if(n===k.RAW)return t;if(y(t[n]))return Y(t[n]);const i=Reflect.get(t,n,o);return v(t),i},set(t,n,o,i){if(t[k.IS_READONLY])return!0;if(y(t[n])){const f=t[n],p=new Set;for(const d in o)p.add(d),this.set(f,d,o[d],i[n]);for(const d in f)p.has(d)||this.deleteProperty(f,d);return!0}if(Reflect.get(t,n,i)===o)return!0;const l=Reflect.set(t,n,o,i),s=M.get(t)||new Set;s.add(n);const u=s.size;return M.set(t,s),N(()=>{const f=Reflect.get(t,n,i);l&&f===o&&u===1&&T(t),M.delete(t)}),l},deleteProperty(t,n){const o=Reflect.get(t,n);if(y(o)){for(const l in o)this.deleteProperty(o,l);return!0}const i=X(t,n),c=Reflect.deleteProperty(t,n);return r=n,N(()=>{i&&c&&o!==void 0&&n===r&&(T(t),r=null)}),c}})}function te(e){const r=Y({value:e});function t(){return r.value}function n(o){r.value=o}return[t,n]}const ne="__v_isRef";var pe;class re{constructor(r){h(this,pe,!0);h(this,"__v_isShallow",!1);h(this,"_rawValue");h(this,"_value");h(this,"getSignal");h(this,"setSignal");this._rawValue=r;const[t,n]=te(r);this.getSignal=t,this.setSignal=n,this._value=t()}get value(){return this.getSignal()}set value(r){this.setSignal(r),this._rawValue=r}}pe=ne;function de(e){return new re(e)}function q(e,r){return Object.assign({},e,r)}function S(e){return["string","number"].includes(typeof e)&&e!==""}function oe(e){return!/^on/.test(e)}function x(e){return g(e)&&(U(e.tag)||w(e.tag))}function a(e){return typeof e=="function"&&!w(e)}function V(e){return[void 0,null,"",!0,!1].includes(e)}function E(e){return document.createTextNode(e)}function he(e,r,...t){const n={tag:e,attrs:r||{},children:t};return a(n.tag)&&(n.tag.prototype._id=Z(),n.children.length===0&&n.attrs.children&&(n.children=n.attrs.children)),n}function A(e){return e.prototype._id}const P=Symbol("Fragment");function w(e){return typeof e=="function"&&e.prototype[P]===P}const W=[];function ie(){W.forEach(e=>{e()}),W.length=0}const G=new WeakMap;function H(e,r=[]){return e.forEach(t=>{g(t)&&(a(t.tag)?r.push({comp:t.tag,compId:A(t.tag),props:q(t.attrs,{children:e})}):S(t.tag)&&H(t.children,r))}),r}function F(e,r=[]){const t=G.get(e)||[];return r.push(...t),t.forEach(n=>{const o=F(n.comp);r.push(...o)}),r}const ce=new Map;function B(e){const r=F(e).map(n=>n.compId);r.unshift(A(e));const t=[];r.forEach(n=>{const o=ce.get(n)||[];t.push(...o)}),t.forEach(n=>{n()})}const $=[];function se(){$.forEach(e=>{e()}),$.length=0}const ue=new Map;function D(e){const r=F(e).map(n=>n.compId);r.unshift(A(e));const t=[];r.forEach(n=>{const o=ue.get(n)||[];t.push(...o)}),t.forEach(n=>{n()})}function m(e,r,t){if(U(e))return I(e,r,t);if(w(e))return R(t);if(a(e)){const n=q(r,{children:t}),o=e(n);return S(o)?E(o):(G.set(e,H(o.children)),m(o.tag,o.attrs,o.children))}}function I(e,r={},t=[""]){if(w(e))return m(e,r,t);const n=document.createElement(e);t.forEach(o=>{if(!V(o)){if(S(o)){const i=E(o);i.nodeValue=o,n.appendChild(i);return}if(typeof o=="function"){const i=R([o]);n.appendChild(i);return}if(O(o)){const i=R(o);n.appendChild(i);return}if(x(o)){const i=I(o.tag,o.attrs,o.children);n.appendChild(i);return}if(g(o)&&a(o.tag)){const i=m(o.tag,o.attrs,o.children);n.appendChild(i);return}C(`render: 不支持 ${o} 值渲染`)}});for(const o in r){const i=r[o];i&&(n[o]=i,o==="ref"&&(i.value=n),typeof i=="function"&&oe(o)&&j(()=>{n[o]=i()}))}if(r.style&&g(r.style))for(const o in r.style){const i=r.style[o];typeof i=="function"?j(()=>n.style[o]=i()):n.style[o]=i}return n}function R(e){const r=document.createDocumentFragment();return e.forEach(t=>{if(!V(t)){if(S(t)){const n=E(t);n.nodeValue=t,r.appendChild(n);return}if(typeof t=="function"){le(r,t);return}if(O(t)){const n=R(t);r.appendChild(n);return}if(x(t)){const n=I(t.tag,t.attrs,t.children);r.appendChild(n);return}if(g(t)&&a(t.tag)){const n=m(t.tag,t.attrs,t.children);r.appendChild(n);return}C(`render: 不支持 ${t} 值渲染`)}}),r}function K(e){if(S(e))return E(e);if(x(e)||g(e)&&a(e.tag))return m(e.tag,e.attrs,e.children)}function fe(e,r){let t=0,n=e.length-1;for(;t<=n;){var o=Math.ceil((t+n)/2);if(r===e[o].key)return o;r<e[o].key?n=o-1:r>e[o].key&&(t=o+1)}return-1}function le(e,r){let t=[],n=!0,o=null;const i=E("");e.appendChild(i),j(()=>{let c=r();if(c&&g(c)&&w(c.tag)){C("不支持响应式节点片段渲染");return}O(c)||(c=[c]),c=c.filter(s=>!V(s));let l=0;for(;l<c.length;){let s=c[l];const u=fe(t,l);if(u>=0){if(L(s,t[u].tree)){l++;continue}const f=K(s);if(!f){c.splice(u,1),l++;continue}const p=t[u].tree;a(p.tag)&&D(p.tag),t[u].node.parentElement.replaceChild(f,t[u].node),a(p.tag)&&B(p.tag),t[u].tree=s,t[u].node=f}else{const f=K(s);if(!f){l++;continue}if(n)e.appendChild(f);else if(t.length===0)o??(o=i.parentElement),o.insertBefore(f,i.nextSibling);else{const p=t[t.length-1].node,d=p.nextSibling;p.parentElement.insertBefore(f,d)}t.push({key:l,tree:s,node:f})}l++}if(t.length>c.length){for(let s=c.length;s<t.length;s++){const u=t[s].tree;a(u.tag)&&D(u.tag),t[s].node.remove(),a(u.tag)&&B(u.tag)}t.splice(c.length,t.length-c.length)}n=!1})}function ge({tag:e,attrs:r,children:t}){const n=m(e,r,t);return se(),N(ie),n}export{ge as a,he as h,de as r};
