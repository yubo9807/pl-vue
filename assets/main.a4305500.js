(()=>{"use strict";function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(t){return["object","array"].includes(e(t))}function n(e,t){if("object"==typeof e&&"object"==typeof t){const o=Object.keys(e),r=Object.keys(t);if(o.length!==r.length)return!1;for(const c of o){if(!r.includes(c))return!1;if(!n(e[c],t[c]))return!1}return!0}return e===t}function o(e){if(void 0!==typeof Promise)Promise.resolve().then(e);else if(void 0!==typeof MutationObserver){const t=new MutationObserver(e),n=document.createTextNode("0");t.observe(n,{characterData:!0}),n.data="1"}else void 0!==typeof process?process.nextTick(e):setTimeout(e,0)}let r=null;const c=new WeakMap;function i(e){r=e,e(),r=null}function l(e){const t=c.get(e);t&&t.forEach(((n,o)=>{const r=n();"boolean"==typeof r&&r&&(t.splice(o,1),c.set(e,t))}))}const s=new WeakMap,a={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function u(e){return!t(e)||s.get(e)?e:new Proxy(e,{get(e,n,o){if(n===a.RAW)return e;!function(e){const t=c.get(e)||[],n=t.some((e=>r===e));r&&!n&&t.push(r),c.set(e,t)}(e);const i=Reflect.get(e,n,o);return t(i)?u(i):i},set(e,t,n,r){const c=Reflect.get(e,t,r),i=Reflect.set(e,t,n,r);return e[a.IS_READONLY]?c:(o((()=>{const o=Reflect.get(e,t,r);i&&c!==n&&o===n&&l(e)})),i)},deleteProperty(e,t){const n=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(e,t),o=Reflect.deleteProperty(e,t);return n&&o&&l(e),o}})}class f{__v_isRef=!0;__v_isShallow=!1;_rawValue;_value;constructor(e){this._rawValue=e,this._value=t(e)?u(e):u({value:e})}get value(){return t(this._rawValue)?this._value:this._value.value}set value(e){this._rawValue=e,t(e)?this._value=e:this._value.value=e}}function d(e){return["string","number"].includes(typeof e)&&""!==e}function p(e){return["className","innerHTML","innerText","textContent"].includes(e)}function h(t){return"object"===e(t)&&("string"==typeof t.tag||b(t.tag))}function g(e){return"function"==typeof e&&!b(e)}function y(e,t,...n){return g(e)&&(e.prototype._id=Number(Math.random().toString().slice(2)).toString(32)),{tag:e,attrs:t||{},children:n}}function m({children:e}){return e}const v=Symbol("Fragment");function b(e){return"function"==typeof e&&e.prototype[v]===v}m.prototype[v]=v;let _=!1;function w(t){_=!0;const n=[];return function t(o){if("object"!==e(o))return;const{tag:r,attrs:c,children:i}=o,l=Object.assign({},c,{children:i});g(r)?(n.push(r.prototype._id),t(r(l))):i.forEach((e=>{t(e)}))}(t),_=!1,n}const E=[];let j=!1;function C(){E.forEach((e=>{e()})),E.length=0,j=!0}const x=new Map;function N(e){w(e).forEach((e=>{const t=x.get(e)||[];0!==t.length&&(t.forEach((e=>e())),x.delete(e))}))}const O=[];let S=!1;const R=new Map;function T(e){w(e).forEach((e=>{const t=R.get(e)||[];0!==t.length&&(t.forEach((e=>e())),R.delete(e))}))}function k(e,t,n){if("string"==typeof e)return M(e,t,n);if(b(e))return A(n);if(g(e)){const o=e(Object.assign({},t,{children:n}));return k(o.tag,o.attrs,o.children)}}function M(t,n={},o=[""]){if(b(t))return k(t,n,o);const r=document.createElement(t);o.forEach((t=>{if(d(t)){const e=document.createTextNode(t);return e.nodeValue=t,void r.appendChild(e)}if("function"!=typeof t)if(t instanceof Array){const e=A(t);r.appendChild(e)}else if(h(t)){const e=M(t.tag,t.attrs,t.children);r.appendChild(e)}else if("object"===e(t)&&g(t.tag)){const e=k(t.tag,t.attrs,t.children);r.appendChild(e)}else console.warn(`render: 不支持 ${t} 值渲染`);else{const e=A([t]);r.appendChild(e)}}));for(const e in n){const t=n[e];r[e]=t,"ref"===e&&(t.value=r),"function"==typeof t&&p(e)&&i((()=>{r[e]=t()}))}if(n.style&&n.style instanceof Object)for(const e in n.style){const t=n.style[e];"function"==typeof t?i((()=>r.style[e]=t())):r.style[e]=t}return r}function A(t){const o=document.createDocumentFragment();return t.forEach((t=>{if(d(t)){const e=document.createTextNode(t);return e.nodeValue=t,void o.appendChild(e)}if("function"==typeof t){let r=[],c=!0,l=null;const s=document.createTextNode("");return o.appendChild(s),void i((()=>{let i=t();if(i&&e(i)&&b(i.tag))return void console.warn("不支持响应式节点片段渲染");i instanceof Array||(i=[i].filter((e=>!function(e){return[void 0,null,"",!0,!1].includes(e)}(e))));let a=0;for(;a<i.length;){const e=i[a],t=a,u=r.findIndex((e=>e.key===t));if(u>=0){if(n(e,r[u].tree)){a++;continue}const t=P(e),o=r[u].tree;g(o.tag)&&T(o),r[u].node.parentElement.replaceChild(t,r[u].node),g(o.tag)&&N(o),r[u].tree=e,r[u].node=t}else{const n=P(e);if(c)o.appendChild(n);else if(0===r.length)l??=s.parentElement,l.insertBefore(n,s.nextSibling);else{const e=r[r.length-1].node,t=e.nextSibling;e.parentElement.insertBefore(n,t)}r.push({key:t,tree:e,node:n})}a++}if(r.length>i.length){for(let e=i.length;e<r.length;e++){const t=r[e].tree;g(t.tag)&&T(t),r[e].node.remove(),g(t.tag)&&N(t)}r.splice(i.length,r.length-i.length)}c=!1}))}if(t instanceof Array){const e=A(t);o.appendChild(e)}else if(h(t)){const e=M(t.tag,t.attrs,t.children);o.appendChild(e)}else if("object"===e(t)&&g(t.tag)){const e=k(t.tag,t.attrs,t.children);o.appendChild(e)}else console.warn(`render: 不支持 ${t} 值渲染`)})),o}function P(t){return d(t)?document.createTextNode(t.toString()):h(t)||"object"===e(t)&&g(t.tag)?k(t.tag,t.attrs,t.children):void 0}const V="demo__bac49";function D(e){return y("p",null,"hello ",e.text," ",e.count)}document.getElementById("root").appendChild(function({tag:e,attrs:t,children:n}){const r=k(e,t,n);if(O.forEach((e=>{e()})),O.length=0,S=!0,r instanceof DocumentFragment){const e=r.children[0];o((()=>{e.parentNode&&C()}))}else r instanceof HTMLElement&&o((()=>{r.parentNode&&C()}));return r}(y((function(){const e=new f(1);return y(m,null,y("h1",{className:V},(()=>e.value)),y(D,{text:"word",count:()=>e.value}),y("button",{onclick:()=>e.value++},"click"))}),null)))})();