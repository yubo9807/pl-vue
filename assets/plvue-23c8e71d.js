var le=Object.defineProperty;var de=(e,n,t)=>n in e?le(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var m=(e,n,t)=>(de(e,typeof n!="symbol"?n+"":n,t),t);function B(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function y(e){return["object","array"].includes(B(e))}function pe(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function L(e,n){if(y(e)&&y(n)){const t=Object.keys(e),r=Object.keys(n);if(t.length!==r.length)return!1;for(const o of t)if(!r.includes(o)||!L(e[o],n[o]))return!1;return!0}else return e===n}function te(){return typeof window=="object"}function w(e){return B(e)==="object"}function V(e){return Array.isArray(e)}function W(e){return typeof e=="string"}function O(e){Promise.resolve().then(e)}function he(){return Number(Math.random().toString().slice(2)).toString(32)}function F(...e){console.warn(...e)}let S=null;const N=new WeakMap;function k(e){S=e,e(),S=null}function ge(e){const n=N.get(e)||[],t=n.some(r=>S===r);S&&!t&&(n.push(S),N.set(e,n))}function J(e){const n=N.get(e);n&&n.forEach((t,r)=>{t()===!0&&(n.splice(r,1),N.set(e,n))})}const me=new WeakMap,D=new WeakMap,x={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function U(e){if(!y(e)||Object.isFrozen(e))return F(`lue cannot be made reactive: ${e}`),e;if(me.get(e))return e;let n=null;return new Proxy(e,{get(t,r,o){if(r===x.RAW)return t;if(y(t[r]))return U(t[r]);const s=Reflect.get(t,r,o);return ge(t),s},set(t,r,o,s){if(t[x.IS_READONLY])return!0;if(y(t[r])){const a=t[r],l=new Set;for(const d in o)l.add(d),this.set(a,d,o[d],s[r]);for(const d in a)l.has(d)||this.deleteProperty(a,d);return!0}if(Reflect.get(t,r,s)===o)return!0;const i=Reflect.set(t,r,o,s),f=D.get(t)||new Set;f.add(r);const h=f.size;return D.set(t,f),O(()=>{const a=Reflect.get(t,r,s);i&&a===o&&h===1&&J(t),D.delete(t)}),i},deleteProperty(t,r){const o=Reflect.get(t,r);if(y(o)){for(const i in o)this.deleteProperty(o,i);return!0}const s=pe(t,r),c=Reflect.deleteProperty(t,r);return n=r,O(()=>{s&&c&&o!==void 0&&r===n&&(J(t),n=null)}),c}})}function ye(e){return!!e[x.RAW]}function ne(e){return ye(e)?e[x.RAW]:e}function we(e){const n=U({value:e});function t(){return n.value}function r(o){n.value=o}return[t,r]}const be="__v_isRef";var We;class Re{constructor(n){m(this,We,!0);m(this,"__v_isShallow",!1);m(this,"_rawValue");m(this,"_value");m(this,"getSignal");m(this,"setSignal");this._rawValue=n;const[t,r]=we(n);this.getSignal=t,this.setSignal=r,this._value=t()}get value(){return this.getSignal()}set value(n){this.setSignal(n),this._rawValue=n}}We=be;function Se(e){return new Re(e)}const E=function(){const e=new WeakMap,n=["null","weakset","weakmap"],t={set(r){const o=new Set;for(const s of r)o.add(E(s));return o},map(r){const o=new Map;for(const[s,c]of r.entries())o.set(s,E(c));return o}};return function(r){const o=B(r);if(typeof r!="object"||n.includes(o))return r;if(e.has(r))return e.get(r);if(t[o])return t[o](r);const s=V(r)?[]:{};Object.setPrototypeOf(s,Object.getPrototypeOf(r)),e.set(r,s);for(const c in r)s[c]=E(r[c]);return s}}();function $(e,n){return Object.assign({},e,n)}function Ee(e,n,t={}){let r=!1;if(r)return;const o=e();t.immediate&&n(o,void 0);let s=E(o),c=!0;return k(()=>{if(r)return!0;const i=e();if(y(i)){t.deep&&!L(i,s)&&(n(i,s),s=E(i));return}if(c){c=!1;return}i!==s&&(n(i,s),s=i)}),()=>{r=!0}}function _(e){return["string","number"].includes(typeof e)&&e!==""}function _e(e){return!/^on/.test(e)}function q(e){return w(e)&&(W(e.tag)||j(e.tag))}function p(e){return typeof e=="function"&&!j(e)}function z(e){return[void 0,null,"",!0,!1].includes(e)}function C(e){return document.createTextNode(e)}function b(e,n,...t){const r={tag:e,attrs:n||{},children:t};return p(r.tag)&&r.children.length===0&&r.attrs.children&&(r.children=r.attrs.children),r}function Y({children:e}){return e}const A=Symbol("Fragment");Y.prototype[A]=A;function j(e){return typeof e=="function"&&e.prototype[A]===A}const T=[];let re=!1;function Ie(e){if(re){O(e);return}T.push(e)}function Ce(){T.forEach(e=>{e()}),T.length=0,re=!0}const oe=new WeakMap;function se(e,n=[]){return e.forEach(t=>{w(t)&&(p(t.tag)?n.push({comp:t.tag,compId:t.tag.prototype._id,props:$(t.attrs,{children:e})}):_(t.tag)&&se(t.children,n))}),n}function Q(e,n=[]){const t=oe.get(e)||[];return n.push(...t),t.forEach(r=>{const o=Q(r.comp);n.push(...o)}),n}const je=new Map;function X(e){const n=Q(e).map(r=>r.compId);n.unshift(e.prototype._id);const t=[];n.forEach(r=>{const o=je.get(r)||[];t.push(...o)}),t.forEach(r=>{r()})}const Z=[];function Me(){Z.forEach(e=>{e()}),Z.length=0}const Oe=new Map;function v(e){const n=Q(e).map(r=>r.compId);n.unshift(e.prototype._id);const t=[];n.forEach(r=>{const o=Oe.get(r)||[];t.push(...o)}),t.forEach(r=>{r()})}function R(e,n,t){if(W(e))return G(e,n,t);if(j(e))return P(t);if(p(e)){const r=$(n,{children:t});e.prototype._id=he();const o=e(r);return _(o)?C(o):(oe.set(e,se(o.children)),R(o.tag,o.attrs,o.children))}}function G(e,n={},t=[""]){if(j(e))return R(e,n,t);const r=document.createElement(e);t.forEach(o=>{if(!z(o)){if(_(o)){const s=C(o);s.nodeValue=o,r.appendChild(s);return}if(typeof o=="function"){const s=P([o]);r.appendChild(s);return}if(V(o)){const s=P(o);r.appendChild(s);return}if(q(o)){const s=G(o.tag,o.attrs,o.children);r.appendChild(s);return}if(w(o)&&p(o.tag)){const s=R(o.tag,o.attrs,o.children);r.appendChild(s);return}F(`render: 不支持 ${o} 值渲染`)}});for(const o in n){const s=n[o];r[o]=s,o==="ref"&&(s.value=r),typeof s=="function"&&_e(o)&&k(()=>{r[o]=s()})}if(n.style&&w(n.style))for(const o in n.style){const s=n.style[o];typeof s=="function"?k(()=>r.style[o]=s()):r.style[o]=s}return r}function P(e){const n=document.createDocumentFragment();return e.forEach(t=>{if(!z(t)){if(_(t)){const r=C(t);r.nodeValue=t,n.appendChild(r);return}if(typeof t=="function"){Ne(n,t);return}if(V(t)){const r=P(t);n.appendChild(r);return}if(q(t)){const r=G(t.tag,t.attrs,t.children);n.appendChild(r);return}if(w(t)&&p(t.tag)){const r=R(t.tag,t.attrs,t.children);n.appendChild(r);return}F(`render: 不支持 ${t} 值渲染`)}}),n}function ee(e){if(_(e))return C(e);if(q(e)||w(e)&&p(e.tag))return R(e.tag,e.attrs,e.children)}function Ne(e,n){let t=[],r=!0,o=null;const s=C("");e.appendChild(s),k(()=>{let c=n();if(c&&w(c)&&j(c.tag)){F("不支持响应式节点片段渲染");return}V(c)||(c=[c]),c=c.filter(f=>!z(f));let i=0;for(;i<c.length;){let f=c[i];const h=i,a=t.findIndex(l=>l.key===h);if(a>=0){if(L(f,t[a].tree)){i++;continue}const l=ee(f);if(!l){c.splice(a,1),i++;continue}const d=t[a].tree;p(d.tag)&&v(d.tag),t[a].node.parentElement.replaceChild(l,t[a].node),p(d.tag)&&X(d.tag),t[a].tree=f,t[a].node=l}else{const l=ee(f);if(!l){i++;continue}if(r)e.appendChild(l);else if(t.length===0)o??(o=s.parentElement),o.insertBefore(l,s.nextSibling);else{const d=t[t.length-1].node,ae=d.nextSibling;d.parentElement.insertBefore(l,ae)}t.push({key:h,tree:f,node:l})}i++}if(t.length>c.length){for(let f=c.length;f<t.length;f++){const h=t[f].tree;p(h.tag)&&v(h.tag),t[f].node.remove(),p(h.tag)&&X(h.tag)}t.splice(c.length,t.length-c.length)}r=!1})}function De({tag:e,attrs:n,children:t}){const r=R(e,n,t);return Me(),O(Ce),r}function K(e){const n=new URL("http://0.0.0.0"+e),t=n.pathname,r=u.routes.find(o=>t.startsWith(o.path+"/")&&o.exact===!1);return{monitor:r?r.path:t,fullPath:n.href.replace(n.origin,""),path:t,query:ke(n.search),hash:n.hash}}function H(e){if(W(e))return e;e=e;const n=e.path;let t="";for(const s in e.query)t+=`&${s}=${e.query[s]}`;t=t?"?"+t:"";const r=e.hash?"#"+e.hash:"";return n+t+r}function ke(e){const n={};return e.replace("?","").split("&").forEach(r=>{const[o,s]=r.split("=");o&&s&&(n[o]=s)}),n}function ce(){return u.mode==="history"?location.href.replace(location.origin+u.base,""):location.hash.slice(1)}function ie(e){return u.routes.find(n=>n.path===e)}function ue(e){const n=H(e);u.mode==="history"?history.pushState({},"",u.base+n):location.hash=n,I(n)}function fe(e){const n=H(e);u.mode==="history"?history.replaceState({},"",u.base+n):location.hash=n,I(n)}function M(e){history.go(e)}function xe(){return{push:ue,replace:fe,go:M}}const u={base:"",mode:"history",ssrDataKey:"g_initialProps",routes:[]};let g=null;function Te(e={}){if(Object.assign(u,e),te()){const n=K(ce());g=U(n)}else g??(g=K("/"));return{back:()=>M(-1),forward:()=>M(1),go:M,push:ue,replace:fe,options:u,currentRoute:ne(g)}}function I(e){const n=K(e);for(const t in n)g[t]=n[t]}function Ke(){return g}function Ae(e){window.addEventListener("popstate",()=>{I(ce())});const n=Se(null);let t;return Ee(()=>g.monitor,async r=>{const o=ie(r);if(!o)return;const{getInitialProps:s}=o.component.prototype;if(typeof s=="function")if(window[u.ssrDataKey])t=window[u.ssrDataKey],delete window[u.ssrDataKey];else{n.value=e.loading;const c=ne(g);t=await s(c)}n.value=o.component},{immediate:!0}),b(Y,null,()=>n.value&&b(n.value,{data:t}))}function Pe(e){let n="";if(u.mode==="history")n=e.url.replace(u.base,"");else{const r=e.url.match(/#.*/);n=r?r[0]:""}I(n);const t=ie(g.monitor);return b(Y,null,t&&b(t.component,{data:e.data}))}function Be(e){return te()?b(Ae,{...e}):b(Pe,{...e})}const Ve={to:"/",type:"push"};function Le(e){e=$(Ve,e);const n=W(e.to)?e.to:H(e.to),t=u.base+(u.mode==="hash"?"#"+n:n),r=xe();function o(s){s.preventDefault(),e.type==="push"?r.push(n):r.replace(n)}return b("a",{className:e.className,href:t,onclick:o},e.children)}export{Le as L,Be as R,De as a,Te as c,b as h,O as n,Ie as o,Se as r,Ke as u,Ee as w};
