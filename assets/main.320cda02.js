(()=>{"use strict";function e(e,t,...n){return{tag:e,attrs:t||{},children:n}}function t({children:e}){return e}const n=Symbol("Fragment");function r(e){return"function"==typeof e&&e.prototype[n]===n}function o(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function c(e){return"object"==typeof e}function l(e,t){if("object"==typeof e&&"object"==typeof t){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const o of n){if(!r.includes(o))return!1;if(!l(e[o],t[o]))return!1}return!0}return e===t}function i(e){return["string","number"].includes(typeof e)&&""!==e}function s(e){return["className","innerHTML","innerText","textContent"].includes(e)}function u(e){return"object"===o(e)&&("string"==typeof e.tag||r(e.tag))}t.prototype[n]=n;let a=null;const f=new WeakMap;function d(e){a=e,e(),a=null}function p(e){const t=f.get(e);t&&t.forEach(((n,r)=>{const o=n();"boolean"==typeof o&&o&&(t.splice(r,1),f.set(e,t))}))}const h=new WeakMap,g={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function y(e){return!c(e)||h.get(e)?e:new Proxy(e,{get(e,t,n){if(t===g.RAW)return e;!function(e){const t=f.get(e)||[];a&&t.push(a),f.set(e,t)}(e);const r=Reflect.get(e,t,n);return c(r)?y(r):r},set(e,t,n,r){const o=Reflect.get(e,t,r),c=Reflect.set(e,t,n,r);return e[g.IS_READONLY]?o:(c&&o!==n&&p(e),c)},deleteProperty(e,t){const n=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(e,t),r=Reflect.deleteProperty(e,t);return n&&r&&p(e),r}})}class m{__v_isRef=!0;__v_isShallow=!1;_rawValue;_value;constructor(e){this._rawValue=e,this._value=c(e)?y(e):y({value:e})}get value(){return c(this._rawValue)?this._value:this._value.value}set value(e){this._rawValue=e,c(e)?this._value=e:this._value.value=e}}function v(e){return e instanceof Array?function(e){let t=new Array(e.length);for(let n=0;n<t.length;n++)t[n]=v(e[n]);return t}(e):"object"===o(e)?function(e){let t={},n=Object.getOwnPropertyNames(e);for(let r=0;r<n.length;r++)t[n[r]]=v(e[n[r]]);return t}(e):e}const _=[];function b(){_.forEach((e=>{e()}))}function w(e,t={},n=[]){if("function"==typeof e&&!r(e)){const r=e(v(Object.assign({},t,{children:n})));return w(r.tag,r.attrs,r.children)}const c=[];return n.forEach((e=>{if("object"===o(e)){const t=w(e.tag,e.attrs,e.children);c.push(t)}else c.push(e)})),{tag:e,attrs:t,children:c}}function j(e,t,n){return"string"==typeof e?E(e,t,n):r(e)?C(n):void 0}function E(e,t={},n=[""]){if(r(e))return j(e,t,n);const o=document.createElement(e);n.forEach((e=>{if(i(e)){const t=document.createTextNode(e);return t.nodeValue=e,void o.appendChild(t)}if("function"!=typeof e)if(e instanceof Array){const t=C(e);o.appendChild(t)}else if(u(e)){const t=E(e.tag,e.attrs,e.children);o.appendChild(t)}else console.warn(`render: 不支持 ${e} 值渲染`);else{const t=C([e]);o.appendChild(t)}}));for(const e in t){const n=t[e];o[e]=n,"ref"===e&&(n.value=o),"function"==typeof n&&s(e)&&d((()=>{o[e]=n()}))}if(t.style&&t.style instanceof Object)for(const e in t.style){const n=t.style[e];"function"==typeof n?d((()=>o.style[e]=n())):o.style[e]=n}return o}function C(e){const t=document.createDocumentFragment();return e.forEach((e=>{if(i(e)){const n=document.createTextNode(e);return n.nodeValue=e,void t.appendChild(n)}if("function"!=typeof e)if(e instanceof Array){const n=C(e);t.appendChild(n)}else if(u(e)){const n=E(e.tag,e.attrs,e.children);t.appendChild(n)}else console.warn(`render: 不支持 ${e} 值渲染`);else{let n=[],r=0;d((()=>{let o=e();if(o instanceof Array||(o=[o]),o=o.filter((e=>e)),o.forEach(((e,o)=>{const c=o,i=n.findIndex((e=>e.key===c));if(i>=0){if(l(e,n[i].tree))return;const t=O(e);n[i].node.parentElement.replaceChild(t,n[i].node),n[i].tree=e,n[i].node=t}else{const o=O(e);if(0===r)t.appendChild(o);else{const e=n[n.length-1].node,t=e.nextSibling;e.parentElement.insertBefore(o,t)}n.push({key:c,tree:e,node:o})}})),n.length>o.length)for(let e=o.length;e<n.length;e++)n[e].node.remove();r++}))}})),t}function O(e){if(i(e))return document.createTextNode(e.toString());if(u(e))return j(e.tag,e.attrs,e.children);if("object"===o(e)&&!r(t=e.tag)&&"function"==typeof t){const t=w(e.tag,e.attrs,e.children);return j(t.tag,t.attrs,t.children)}var t}const N="demo__bac49";function R(t){return e("div",null,e("p",null,"子组件"),e("p",null,"props: ",t.count),e("p",null,t.children))}document.getElementById("root").appendChild(function({tag:e,attrs:t,children:n}){const r=w(e,t,n),o=j(r.tag,r.attrs,r.children);if(o instanceof DocumentFragment){const e=o.children[0];Promise.resolve().then((()=>{e.parentNode&&b()}))}else o instanceof HTMLElement&&Promise.resolve().then((()=>{o.parentNode&&b()}));return o}(e((function(){const n=new m(1);return e(t,null,"父组件",e("h1",{className:N},(()=>n.value)),e(R,{count:()=>n.value},e("p",null,"插槽1"),e("p",null,"插槽2")),e("button",{onclick:()=>n.value++},"click"))}),null)))})();