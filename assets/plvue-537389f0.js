var ae=Object.defineProperty;var le=(e,n,t)=>n in e?ae(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var g=(e,n,t)=>(le(e,typeof n!="symbol"?n+"":n,t),t);function K(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function y(e){return["object","array"].includes(K(e))}function de(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function B(e,n){if(y(e)&&y(n)){const t=Object.keys(e),r=Object.keys(n);if(t.length!==r.length)return!1;for(const o of t)if(!r.includes(o)||!B(e[o],n[o]))return!1;return!0}else return e===n}function te(){return typeof window=="object"}function w(e){return K(e)==="object"}function P(e){return Array.isArray(e)}function V(e){return typeof e=="string"}function D(e){Promise.resolve().then(e)}function pe(){return Number(Math.random().toString().slice(2)).toString(32)}function W(...e){console.warn(...e)}let S=null;const M=new WeakMap;function k(e){S=e,e(),S=null}function he(e){const n=M.get(e)||[],t=n.some(r=>S===r);S&&!t&&(n.push(S),M.set(e,n))}function H(e){const n=M.get(e);n&&n.forEach((t,r)=>{t()===!0&&(n.splice(r,1),M.set(e,n))})}const ge=new WeakMap,I=new WeakMap,N={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function L(e){if(!y(e)||Object.isFrozen(e))return W(`lue cannot be made reactive: ${e}`),e;if(ge.get(e))return e;let n=null;return new Proxy(e,{get(t,r,o){if(r===N.RAW)return t;if(y(t[r]))return L(t[r]);const c=Reflect.get(t,r,o);return he(t),c},set(t,r,o,c){if(t[N.IS_READONLY])return!0;if(y(t[r])){const a=t[r],l=new Set;for(const d in o)l.add(d),this.set(a,d,o[d],c[r]);for(const d in a)l.has(d)||this.deleteProperty(a,d);return!0}if(Reflect.get(t,r,c)===o)return!0;const i=Reflect.set(t,r,o,c),u=I.get(t)||new Set;u.add(r);const h=u.size;return I.set(t,u),D(()=>{const a=Reflect.get(t,r,c);i&&a===o&&h===1&&H(t),I.delete(t)}),i},deleteProperty(t,r){const o=Reflect.get(t,r);if(y(o)){for(const i in o)this.deleteProperty(o,i);return!0}const c=de(t,r),s=Reflect.deleteProperty(t,r);return n=r,D(()=>{c&&s&&o!==void 0&&r===n&&(H(t),n=null)}),s}})}function ye(e){return!!e[N.RAW]}function ne(e){return ye(e)?e[N.RAW]:e}function me(e){const n=L({value:e});function t(){return n.value}function r(o){n.value=o}return[t,r]}const we="__v_isRef";var Ve;class be{constructor(n){g(this,Ve,!0);g(this,"__v_isShallow",!1);g(this,"_rawValue");g(this,"_value");g(this,"getSignal");g(this,"setSignal");this._rawValue=n;const[t,r]=me(n);this.getSignal=t,this.setSignal=r,this._value=t()}get value(){return this.getSignal()}set value(n){this.setSignal(n),this._rawValue=n}}Ve=we;function Re(e){return new be(e)}const E=function(){const e=new WeakMap,n=["null","weakset","weakmap"],t={set(r){const o=new Set;for(const c of r)o.add(E(c));return o},map(r){const o=new Map;for(const[c,s]of r.entries())o.set(c,E(s));return o}};return function(r){const o=K(r);if(typeof r!="object"||n.includes(o))return r;if(e.has(r))return e.get(r);if(t[o])return t[o](r);const c=P(r)?[]:{};Object.setPrototypeOf(c,Object.getPrototypeOf(r)),e.set(r,c);for(const s in r)c[s]=E(r[s]);return c}}();function U(e,n){return Object.assign({},e,n)}function Se(e,n,t={}){let r=!1;if(r)return;const o=e();t.immediate&&n(o,void 0);let c=E(o),s=!0;return k(()=>{const i=e();if(y(i)){t.deep&&!B(i,c)&&(n(i,c),c=E(i));return}if(s){s=!1;return}i!==c&&(n(i,c),c=i)}),()=>{r=!0}}function _(e){return["string","number"].includes(typeof e)&&e!==""}function Ee(e){return!/^on/.test(e)}function $(e){return w(e)&&(V(e.tag)||j(e.tag))}function p(e){return typeof e=="function"&&!j(e)}function q(e){return[void 0,null,"",!0,!1].includes(e)}function C(e){return document.createTextNode(e)}function b(e,n,...t){const r={tag:e,attrs:n||{},children:t};return p(r.tag)&&r.children.length===0&&r.attrs.children&&(r.children=r.attrs.children),r}function z({children:e}){return e}const x=Symbol("Fragment");z.prototype[x]=x;function j(e){return typeof e=="function"&&e.prototype[x]===x}const J=[];function _e(){J.forEach(e=>{e()}),J.length=0}const re=new WeakMap;function oe(e,n=[]){return e.forEach(t=>{w(t)&&(p(t.tag)?n.push({comp:t.tag,compId:t.tag.prototype._id,props:U(t.attrs,{children:e})}):_(t.tag)&&oe(t.children,n))}),n}function Y(e,n=[]){const t=re.get(e)||[];return n.push(...t),t.forEach(r=>{const o=Y(r.comp);n.push(...o)}),n}const Ce=new Map;function X(e){const n=Y(e).map(r=>r.compId);n.unshift(e.prototype._id);const t=[];n.forEach(r=>{const o=Ce.get(r)||[];t.push(...o)}),t.forEach(r=>{r()})}const Z=[];function je(){Z.forEach(e=>{e()}),Z.length=0}const Oe=new Map;function v(e){const n=Y(e).map(r=>r.compId);n.unshift(e.prototype._id);const t=[];n.forEach(r=>{const o=Oe.get(r)||[];t.push(...o)}),t.forEach(r=>{r()})}function R(e,n,t){if(V(e))return Q(e,n,t);if(j(e))return A(t);if(p(e)){const r=U(n,{children:t});e.prototype._id=pe();const o=e(r);return _(o)?C(o):(re.set(e,oe(o.children)),R(o.tag,o.attrs,o.children))}}function Q(e,n={},t=[""]){if(j(e))return R(e,n,t);const r=document.createElement(e);t.forEach(o=>{if(!q(o)){if(_(o)){const c=C(o);c.nodeValue=o,r.appendChild(c);return}if(typeof o=="function"){const c=A([o]);r.appendChild(c);return}if(P(o)){const c=A(o);r.appendChild(c);return}if($(o)){const c=Q(o.tag,o.attrs,o.children);r.appendChild(c);return}if(w(o)&&p(o.tag)){const c=R(o.tag,o.attrs,o.children);r.appendChild(c);return}W(`render: 不支持 ${o} 值渲染`)}});for(const o in n){const c=n[o];r[o]=c,o==="ref"&&(c.value=r),typeof c=="function"&&Ee(o)&&k(()=>{r[o]=c()})}if(n.style&&w(n.style))for(const o in n.style){const c=n.style[o];typeof c=="function"?k(()=>r.style[o]=c()):r.style[o]=c}return r}function A(e){const n=document.createDocumentFragment();return e.forEach(t=>{if(!q(t)){if(_(t)){const r=C(t);r.nodeValue=t,n.appendChild(r);return}if(typeof t=="function"){Me(n,t);return}if(P(t)){const r=A(t);n.appendChild(r);return}if($(t)){const r=Q(t.tag,t.attrs,t.children);n.appendChild(r);return}if(w(t)&&p(t.tag)){const r=R(t.tag,t.attrs,t.children);n.appendChild(r);return}W(`render: 不支持 ${t} 值渲染`)}}),n}function ee(e){if(_(e))return C(e);if($(e)||w(e)&&p(e.tag))return R(e.tag,e.attrs,e.children)}function Me(e,n){let t=[],r=!0,o=null;const c=C("");e.appendChild(c),k(()=>{let s=n();if(s&&w(s)&&j(s.tag)){W("不支持响应式节点片段渲染");return}P(s)||(s=[s]),s=s.filter(u=>!q(u));let i=0;for(;i<s.length;){let u=s[i];const h=i,a=t.findIndex(l=>l.key===h);if(a>=0){if(B(u,t[a].tree)){i++;continue}const l=ee(u);if(!l){s.splice(a,1),i++;continue}const d=t[a].tree;p(d.tag)&&v(d.tag),t[a].node.parentElement.replaceChild(l,t[a].node),p(d.tag)&&X(d.tag),t[a].tree=u,t[a].node=l}else{const l=ee(u);if(!l){i++;continue}if(r)e.appendChild(l);else if(t.length===0)o??(o=c.parentElement),o.insertBefore(l,c.nextSibling);else{const d=t[t.length-1].node,fe=d.nextSibling;d.parentElement.insertBefore(l,fe)}t.push({key:h,tree:u,node:l})}i++}if(t.length>s.length){for(let u=s.length;u<t.length;u++){const h=t[u].tree;p(h.tag)&&v(h.tag),t[u].node.remove(),p(h.tag)&&X(h.tag)}t.splice(s.length,t.length-s.length)}r=!1})}function Fe({tag:e,attrs:n,children:t}){const r=R(e,n,t);return je(),D(_e),r}function T(e){const n=new URL("http://0.0.0.0"+e);return{fullPath:n.href.replace(n.origin,""),path:n.pathname,query:ke(n.search),hash:n.hash}}function G(e){if(V(e))return e;e=e;const n=e.path;let t="";for(const c in e.query)t+=`&${c}=${e.query[c]}`;t=t?"?"+t:"";const r=e.hash?"#"+e.hash:"";return n+t+r}function ke(e){const n={};return e.replace("?","").split("&").forEach(r=>{const[o,c]=r.split("=");o&&c&&(n[o]=c)}),n}function ce(e){const n=G(e);f.mode==="history"?history.pushState({},"",f.base+n):location.hash=n,F(n)}function se(e){const n=G(e);f.mode==="history"?history.replaceState({},"",f.base+n):location.hash=n,F(n)}function O(e){history.go(e)}function Ne(){return{push:ce,replace:se,go:O}}const f={base:"",mode:"history",ssrDataKey:"g_initialProps",routes:[]};let m=null;function Ie(e={}){if(Object.assign(f,e),te()){const n=T(ie());m=L(n)}else m??(m=T("/"));return{back:()=>O(-1),forward:()=>O(1),go:O,push:ce,replace:se,options:f,currentRoute:ne(m)}}function F(e){const n=T(e);for(const t in n)m[t]=n[t]}function ie(){return f.mode==="history"?location.href.replace(location.origin+f.base,""):location.hash.slice(1)}function ue(e){return f.routes.find(t=>t.exact||t.exact===void 0?e===t.path:(e+"/").startsWith(t.path+"/"))}function xe(e){window.addEventListener("popstate",()=>{F(ie())});const n=Re(null);let t;return Se(()=>m.path,async r=>{const o=ue(r);if(!o)return;const{getInitialProps:c}=o.component.prototype;if(typeof c=="function")if(window[f.ssrDataKey])t=window[f.ssrDataKey],delete window[f.ssrDataKey];else{n.value=e.loading;const s=ne(m);t=await c(s)}n.value=o.component},{immediate:!0}),b(z,null,()=>n.value&&b(n.value,{data:t}))}function Ae(e){let n="";if(f.mode==="history")n=e.url.replace(f.base,"");else{const r=e.url.match(/#.*/);n=r?r[0]:""}F(n);const t=ue(m.path);return b(z,null,t&&b(t.component,null))}function De(e){return te()?b(xe,{...e}):b(Ae,{...e})}const Pe={to:"/",type:"push"};function Te(e){e=U(Pe,e);const n=V(e.to)?e.to:G(e.to),t=f.base+(f.mode==="hash"?"#"+n:n),r=Ne();function o(c){c.preventDefault(),e.type==="push"?r.push(n):r.replace(n)}return b("a",{href:t,onclick:o},e.children)}export{Te as L,De as R,Ie as c,b as h,Fe as r};
