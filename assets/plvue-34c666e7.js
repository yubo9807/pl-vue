var lt=Object.defineProperty;var dt=(t,n,e)=>n in t?lt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var m=(t,n,e)=>(dt(t,typeof n!="symbol"?n+"":n,e),e);function B(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function y(t){return["object","array"].includes(B(t))}function pt(t,n){return Object.prototype.hasOwnProperty.call(t,n)}function L(t,n){if(y(t)&&y(n)){const e=Object.keys(t),r=Object.keys(n);if(e.length!==r.length)return!1;for(const o of e)if(!r.includes(o)||!L(t[o],n[o]))return!1;return!0}else return t===n}function et(){return typeof window=="object"}function w(t){return B(t)==="object"}function V(t){return Array.isArray(t)}function W(t){return typeof t=="string"}function O(t){Promise.resolve().then(t)}function ht(){return Number(Math.random().toString().slice(2)).toString(32)}function F(...t){console.warn(...t)}let S=null;const k=new WeakMap;function N(t){S=t,t(),S=null}function gt(t){const n=k.get(t)||[],e=n.some(r=>S===r);S&&!e&&(n.push(S),k.set(t,n))}function J(t){const n=k.get(t);n&&n.forEach((e,r)=>{e()===!0&&(n.splice(r,1),k.set(t,n))})}const mt=new WeakMap,D=new WeakMap,x={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function U(t){if(!y(t)||Object.isFrozen(t))return F(`lue cannot be made reactive: ${t}`),t;if(mt.get(t))return t;let n=null;return new Proxy(t,{get(e,r,o){if(r===x.RAW)return e;if(y(e[r]))return U(e[r]);const s=Reflect.get(e,r,o);return gt(e),s},set(e,r,o,s){if(e[x.IS_READONLY])return!0;if(y(e[r])){const a=e[r],l=new Set;for(const d in o)l.add(d),this.set(a,d,o[d],s[r]);for(const d in a)l.has(d)||this.deleteProperty(a,d);return!0}if(Reflect.get(e,r,s)===o)return!0;const i=Reflect.set(e,r,o,s),f=D.get(e)||new Set;f.add(r);const h=f.size;return D.set(e,f),O(()=>{const a=Reflect.get(e,r,s);i&&a===o&&h===1&&J(e),D.delete(e)}),i},deleteProperty(e,r){const o=Reflect.get(e,r);if(y(o)){for(const i in o)this.deleteProperty(o,i);return!0}const s=pt(e,r),c=Reflect.deleteProperty(e,r);return n=r,O(()=>{s&&c&&o!==void 0&&r===n&&(J(e),n=null)}),c}})}function yt(t){return!!t[x.RAW]}function nt(t){return yt(t)?t[x.RAW]:t}function wt(t){const n=U({value:t});function e(){return n.value}function r(o){n.value=o}return[e,r]}const bt="__v_isRef";var Wt;class Rt{constructor(n){m(this,Wt,!0);m(this,"__v_isShallow",!1);m(this,"_rawValue");m(this,"_value");m(this,"getSignal");m(this,"setSignal");this._rawValue=n;const[e,r]=wt(n);this.getSignal=e,this.setSignal=r,this._value=e()}get value(){return this.getSignal()}set value(n){this.setSignal(n),this._rawValue=n}}Wt=bt;function St(t){return new Rt(t)}const E=function(){const t=new WeakMap,n=["null","weakset","weakmap"],e={set(r){const o=new Set;for(const s of r)o.add(E(s));return o},map(r){const o=new Map;for(const[s,c]of r.entries())o.set(s,E(c));return o}};return function(r){const o=B(r);if(typeof r!="object"||n.includes(o))return r;if(t.has(r))return t.get(r);if(e[o])return e[o](r);const s=V(r)?[]:{};Object.setPrototypeOf(s,Object.getPrototypeOf(r)),t.set(r,s);for(const c in r)s[c]=E(r[c]);return s}}();function $(t,n){return Object.assign({},t,n)}function Et(t,n,e={}){let r=!1;if(r)return;const o=t();e.immediate&&n(o,void 0);let s=E(o),c=!0;return N(()=>{const i=t();if(y(i)){e.deep&&!L(i,s)&&(n(i,s),s=E(i));return}if(c){c=!1;return}i!==s&&(n(i,s),s=i)}),()=>{r=!0}}function _(t){return["string","number"].includes(typeof t)&&t!==""}function _t(t){return!/^on/.test(t)}function q(t){return w(t)&&(W(t.tag)||j(t.tag))}function p(t){return typeof t=="function"&&!j(t)}function z(t){return[void 0,null,"",!0,!1].includes(t)}function C(t){return document.createTextNode(t)}function b(t,n,...e){const r={tag:t,attrs:n||{},children:e};return p(r.tag)&&r.children.length===0&&r.attrs.children&&(r.children=r.attrs.children),r}function Y({children:t}){return t}const A=Symbol("Fragment");Y.prototype[A]=A;function j(t){return typeof t=="function"&&t.prototype[A]===A}const T=[];let rt=!1;function It(t){if(rt){O(t);return}T.push(t)}function Ct(){T.forEach(t=>{t()}),T.length=0,rt=!0}const ot=new WeakMap;function st(t,n=[]){return t.forEach(e=>{w(e)&&(p(e.tag)?n.push({comp:e.tag,compId:e.tag.prototype._id,props:$(e.attrs,{children:t})}):_(e.tag)&&st(e.children,n))}),n}function Q(t,n=[]){const e=ot.get(t)||[];return n.push(...e),e.forEach(r=>{const o=Q(r.comp);n.push(...o)}),n}const jt=new Map;function X(t){const n=Q(t).map(r=>r.compId);n.unshift(t.prototype._id);const e=[];n.forEach(r=>{const o=jt.get(r)||[];e.push(...o)}),e.forEach(r=>{r()})}const Z=[];function Mt(){Z.forEach(t=>{t()}),Z.length=0}const Ot=new Map;function v(t){const n=Q(t).map(r=>r.compId);n.unshift(t.prototype._id);const e=[];n.forEach(r=>{const o=Ot.get(r)||[];e.push(...o)}),e.forEach(r=>{r()})}function R(t,n,e){if(W(t))return G(t,n,e);if(j(t))return P(e);if(p(t)){const r=$(n,{children:e});t.prototype._id=ht();const o=t(r);return _(o)?C(o):(ot.set(t,st(o.children)),R(o.tag,o.attrs,o.children))}}function G(t,n={},e=[""]){if(j(t))return R(t,n,e);const r=document.createElement(t);e.forEach(o=>{if(!z(o)){if(_(o)){const s=C(o);s.nodeValue=o,r.appendChild(s);return}if(typeof o=="function"){const s=P([o]);r.appendChild(s);return}if(V(o)){const s=P(o);r.appendChild(s);return}if(q(o)){const s=G(o.tag,o.attrs,o.children);r.appendChild(s);return}if(w(o)&&p(o.tag)){const s=R(o.tag,o.attrs,o.children);r.appendChild(s);return}F(`render: 不支持 ${o} 值渲染`)}});for(const o in n){const s=n[o];r[o]=s,o==="ref"&&(s.value=r),typeof s=="function"&&_t(o)&&N(()=>{r[o]=s()})}if(n.style&&w(n.style))for(const o in n.style){const s=n.style[o];typeof s=="function"?N(()=>r.style[o]=s()):r.style[o]=s}return r}function P(t){const n=document.createDocumentFragment();return t.forEach(e=>{if(!z(e)){if(_(e)){const r=C(e);r.nodeValue=e,n.appendChild(r);return}if(typeof e=="function"){kt(n,e);return}if(V(e)){const r=P(e);n.appendChild(r);return}if(q(e)){const r=G(e.tag,e.attrs,e.children);n.appendChild(r);return}if(w(e)&&p(e.tag)){const r=R(e.tag,e.attrs,e.children);n.appendChild(r);return}F(`render: 不支持 ${e} 值渲染`)}}),n}function tt(t){if(_(t))return C(t);if(q(t)||w(t)&&p(t.tag))return R(t.tag,t.attrs,t.children)}function kt(t,n){let e=[],r=!0,o=null;const s=C("");t.appendChild(s),N(()=>{let c=n();if(c&&w(c)&&j(c.tag)){F("不支持响应式节点片段渲染");return}V(c)||(c=[c]),c=c.filter(f=>!z(f));let i=0;for(;i<c.length;){let f=c[i];const h=i,a=e.findIndex(l=>l.key===h);if(a>=0){if(L(f,e[a].tree)){i++;continue}const l=tt(f);if(!l){c.splice(a,1),i++;continue}const d=e[a].tree;p(d.tag)&&v(d.tag),e[a].node.parentElement.replaceChild(l,e[a].node),p(d.tag)&&X(d.tag),e[a].tree=f,e[a].node=l}else{const l=tt(f);if(!l){i++;continue}if(r)t.appendChild(l);else if(e.length===0)o??(o=s.parentElement),o.insertBefore(l,s.nextSibling);else{const d=e[e.length-1].node,at=d.nextSibling;d.parentElement.insertBefore(l,at)}e.push({key:h,tree:f,node:l})}i++}if(e.length>c.length){for(let f=c.length;f<e.length;f++){const h=e[f].tree;p(h.tag)&&v(h.tag),e[f].node.remove(),p(h.tag)&&X(h.tag)}e.splice(c.length,e.length-c.length)}r=!1})}function Dt({tag:t,attrs:n,children:e}){const r=R(t,n,e);return Mt(),O(Ct),r}function K(t){const n=new URL("http://0.0.0.0"+t),e=n.pathname,r=u.routes.find(o=>e.startsWith(o.path+"/")&&o.exact===!1);return{monitor:r?r.path:e,fullPath:n.href.replace(n.origin,""),path:e,query:Nt(n.search),hash:n.hash}}function H(t){if(W(t))return t;t=t;const n=t.path;let e="";for(const s in t.query)e+=`&${s}=${t.query[s]}`;e=e?"?"+e:"";const r=t.hash?"#"+t.hash:"";return n+e+r}function Nt(t){const n={};return t.replace("?","").split("&").forEach(r=>{const[o,s]=r.split("=");o&&s&&(n[o]=s)}),n}function ct(){return u.mode==="history"?location.href.replace(location.origin+u.base,""):location.hash.slice(1)}function it(t){return u.routes.find(n=>n.path===t)}function ut(t){const n=H(t);u.mode==="history"?history.pushState({},"",u.base+n):location.hash=n,I(n)}function ft(t){const n=H(t);u.mode==="history"?history.replaceState({},"",u.base+n):location.hash=n,I(n)}function M(t){history.go(t)}function xt(){return{push:ut,replace:ft,go:M}}const u={base:"",mode:"history",ssrDataKey:"g_initialProps",routes:[]};let g=null;function Tt(t={}){if(Object.assign(u,t),et()){const n=K(ct());g=U(n)}else g??(g=K("/"));return{back:()=>M(-1),forward:()=>M(1),go:M,push:ut,replace:ft,options:u,currentRoute:nt(g)}}function I(t){const n=K(t);for(const e in n)g[e]=n[e]}function Kt(){return g}function At(t){window.addEventListener("popstate",()=>{I(ct())});const n=St(null);let e;return Et(()=>g.monitor,async r=>{const o=it(r);if(!o)return;const{getInitialProps:s}=o.component.prototype;if(typeof s=="function")if(window[u.ssrDataKey])e=window[u.ssrDataKey],delete window[u.ssrDataKey];else{n.value=t.loading;const c=nt(g);e=await s(c)}n.value=o.component},{immediate:!0}),b(Y,null,()=>n.value&&b(n.value,{data:e}))}function Pt(t){let n="";if(u.mode==="history")n=t.url.replace(u.base,"");else{const r=t.url.match(/#.*/);n=r?r[0]:""}I(n);const e=it(g.monitor);return b(Y,null,e&&b(e.component,{data:t.data}))}function Bt(t){return et()?b(At,{...t}):b(Pt,{...t})}const Vt={to:"/",type:"push"};function Lt(t){t=$(Vt,t);const n=W(t.to)?t.to:H(t.to),e=u.base+(u.mode==="hash"?"#"+n:n),r=xt();function o(s){s.preventDefault(),t.type==="push"?r.push(n):r.replace(n)}return b("a",{href:e,onclick:o},t.children)}export{Lt as L,Bt as R,Dt as a,Tt as c,b as h,O as n,It as o,St as r,Kt as u,Et as w};
