var ge=Object.defineProperty;var me=(e,n,t)=>n in e?ge(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var h=(e,n,t)=>(me(e,typeof n!="symbol"?n+"":n,t),t);function $(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function w(e){return["object","array"].includes($(e))}function ye(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function q(e,n){if(w(e)&&w(n)){const t=Object.keys(e),r=Object.keys(n);if(t.length!==r.length)return!1;for(const o of t)if(!r.includes(o)||!q(e[o],n[o]))return!1;return!0}else return e===n}function se(){return typeof window=="object"}function b(e){return $(e)==="object"}function W(e){return Array.isArray(e)}function I(e){return typeof e=="string"}function O(e){Promise.resolve().then(e)}function we(){return Number(Math.random().toString().slice(2)).toString(32)}function C(...e){console.warn(...e)}let E=null;const x=new WeakMap;function A(e){E=e,e(),E=null}function be(e){const n=x.get(e)||[],t=n.some(r=>E===r);E&&!t&&(n.push(E),x.set(e,n))}function Z(e){const n=x.get(e);n&&n.forEach((t,r)=>{t()===!0&&(n.splice(r,1),x.set(e,n))})}const Re=new WeakMap,D=new WeakMap,P={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function z(e){if(!w(e)||Object.isFrozen(e))return C(`lue cannot be made reactive: ${e}`),e;if(Re.get(e))return e;let n=null;return new Proxy(e,{get(t,r,o){if(r===P.RAW)return t;if(w(t[r]))return z(t[r]);const s=Reflect.get(t,r,o);return be(t),s},set(t,r,o,s){if(t[P.IS_READONLY])return!0;if(w(t[r])){const l=t[r],d=new Set;for(const g in o)d.add(g),this.set(l,g,o[g],s[r]);for(const g in l)d.has(g)||this.deleteProperty(l,g);return!0}if(Reflect.get(t,r,s)===o)return!0;const u=Reflect.set(t,r,o,s),i=D.get(t)||new Set;i.add(r);const f=i.size;return D.set(t,i),O(()=>{const l=Reflect.get(t,r,s);u&&l===o&&f===1&&Z(t),D.delete(t)}),u},deleteProperty(t,r){const o=Reflect.get(t,r);if(w(o)){for(const u in o)this.deleteProperty(o,u);return!0}const s=ye(t,r),c=Reflect.deleteProperty(t,r);return n=r,O(()=>{s&&c&&o!==void 0&&r===n&&(Z(t),n=null)}),c}})}function Ee(e){return!!e[P.RAW]}function ce(e){return Ee(e)?e[P.RAW]:e}function Se(e){const n=z({value:e});function t(){return n.value}function r(o){n.value=o}return[t,r]}const ie="__v_isRef";var Le;class _e{constructor(n){h(this,Le,!0);h(this,"__v_isShallow",!1);h(this,"_rawValue");h(this,"_value");h(this,"getSignal");h(this,"setSignal");this._rawValue=n;const[t,r]=Se(n);this.getSignal=t,this.setSignal=r,this._value=t()}get value(){return this.getSignal()}set value(n){this.setSignal(n),this._rawValue=n}}Le=ie;function Ce(e){return new _e(e)}class je{constructor(n){h(this,"fn");this.fn=n}}var $e;class v{constructor(n,t){h(this,"__v_isReadonly",!0);h(this,$e,!0);h(this,"_cacheable",!0);h(this,"_dirty",!0);h(this,"computed");h(this,"_setter");this.computed=new je(n),this._setter=t}get value(){return this.computed.fn()}set value(n){this._setter?this._setter(n):C("Write operation failed: computed value is readonly")}}$e=ie;function ze(e){return typeof e=="function"?new v(e):new v(e.get,e.set)}const S=function(){const e=new WeakMap,n=["null","weakset","weakmap"],t={set(r){const o=new Set;for(const s of r)o.add(S(s));return o},map(r){const o=new Map;for(const[s,c]of r.entries())o.set(s,S(c));return o}};return function(r){const o=$(r);if(typeof r!="object"||n.includes(o))return r;if(e.has(r))return e.get(r);if(t[o])return t[o](r);const s=W(r)?[]:{};Object.setPrototypeOf(s,Object.getPrototypeOf(r)),e.set(r,s);for(const c in r)s[c]=S(r[c]);return s}}();function H(e,n){return Object.assign({},e,n)}function ke(e,n,t={}){let r=!1;if(r)return;const o=e();t.immediate&&n(o,void 0);let s=S(o),c=!0;return A(()=>{if(r)return!0;const u=e();if(w(u)){t.deep&&!q(u,s)&&(n(u,s),s=S(u));return}if(c){c=!1;return}u!==s&&(n(u,s),s=u)}),()=>{r=!0}}function j(e){return["string","number"].includes(typeof e)&&e!==""}function Me(e){return!/^on/.test(e)}function Y(e){return b(e)&&(I(e.tag)||M(e.tag))}function p(e){return typeof e=="function"&&!M(e)}function Q(e){return[void 0,null,"",!0,!1].includes(e)}function k(e){return document.createTextNode(e)}function y(e,n,...t){const r={tag:e,attrs:n||{},children:t};return p(r.tag)&&(r.tag.prototype._id=we(),r.children.length===0&&r.attrs.children&&(r.children=r.attrs.children)),r}function B(e){return e.prototype._id}function F({children:e}){return e}const V=Symbol("Fragment");F.prototype[V]=V;function M(e){return typeof e=="function"&&e.prototype[V]===V}const U=[];let ue=!1;function Ne(e){if(ue){O(e);return}U.push(e)}function Oe(){U.forEach(e=>{e()}),U.length=0,ue=!0}const fe=new WeakMap;function ae(e,n=[]){return e.forEach(t=>{b(t)&&(p(t.tag)?n.push({comp:t.tag,compId:B(t.tag),props:H(t.attrs,{children:e})}):j(t.tag)&&ae(t.children,n))}),n}function G(e,n=[]){const t=fe.get(e)||[];return n.push(...t),t.forEach(r=>{const o=G(r.comp);n.push(...o)}),n}const K=new Map;function xe(e,n){const t=B(e),r=K.get(t)||[];r.some(s=>s===n)||(r.push(n),K.set(t,r))}function ee(e){const n=G(e).map(r=>r.compId);n.unshift(B(e));const t=[];n.forEach(r=>{const o=K.get(r)||[];t.push(...o)}),t.forEach(r=>{r()})}const te=[];function Ae(){te.forEach(e=>{e()}),te.length=0}const Pe=new Map;function ne(e){const n=G(e).map(r=>r.compId);n.unshift(B(e));const t=[];n.forEach(r=>{const o=Pe.get(r)||[];t.push(...o)}),t.forEach(r=>{r()})}function R(e,n,t){if(I(e))return J(e,n,t);if(M(e))return _(t);if(p(e)){const r=H(n,{children:t}),o=e(r);return j(o)?k(o):(fe.set(e,ae(o.children)),R(o.tag,o.attrs,o.children))}}function J(e,n={},t=[""]){if(M(e))return R(e,n,t);const r=document.createElement(e);t.forEach(o=>{if(!Q(o)){if(j(o)){const s=k(o);s.nodeValue=o,r.appendChild(s);return}if(typeof o=="function"){const s=_([o]);r.appendChild(s);return}if(W(o)){const s=_(o);r.appendChild(s);return}if(Y(o)){const s=J(o.tag,o.attrs,o.children);r.appendChild(s);return}if(b(o)&&p(o.tag)){const s=R(o.tag,o.attrs,o.children);r.appendChild(s);return}C(`render: 不支持 ${o} 值渲染`)}});for(const o in n){const s=n[o];s&&(r[o]=s,o==="ref"&&(s.value=r),typeof s=="function"&&Me(o)&&A(()=>{r[o]=s()}))}if(n.style&&b(n.style))for(const o in n.style){const s=n.style[o];typeof s=="function"?A(()=>r.style[o]=s()):r.style[o]=s}return r}function _(e){const n=document.createDocumentFragment();return e.forEach(t=>{if(!Q(t)){if(j(t)){const r=k(t);r.nodeValue=t,n.appendChild(r);return}if(typeof t=="function"){We(n,t);return}if(W(t)){const r=_(t);n.appendChild(r);return}if(Y(t)){const r=J(t.tag,t.attrs,t.children);n.appendChild(r);return}if(b(t)&&p(t.tag)){const r=R(t.tag,t.attrs,t.children);n.appendChild(r);return}C(`render: 不支持 ${t} 值渲染`)}}),n}function re(e){if(j(e))return k(e);if(Y(e)||b(e)&&p(e.tag))return R(e.tag,e.attrs,e.children)}function Ve(e,n){let t=0,r=e.length-1;for(;t<=r;){var o=Math.ceil((t+r)/2);if(n===e[o].key)return o;n<e[o].key?r=o-1:n>e[o].key&&(t=o+1)}return-1}function We(e,n){let t=[],r=!0,o=null;const s=k("");e.appendChild(s),A(()=>{let c=n();if(c&&b(c)&&M(c.tag)){C("不支持响应式节点片段渲染");return}W(c)||(c=[c]),c=c.filter(i=>!Q(i));let u=0;for(;u<c.length;){let i=c[u];const f=Ve(t,u);if(f>=0){if(q(i,t[f].tree)){u++;continue}const l=re(i);if(!l){c.splice(f,1),u++;continue}const d=t[f].tree;p(d.tag)&&ne(d.tag),t[f].node.parentElement.replaceChild(l,t[f].node),p(d.tag)&&ee(d.tag),t[f].tree=i,t[f].node=l}else{const l=re(i);if(!l){u++;continue}if(r)e.appendChild(l);else if(t.length===0)o??(o=s.parentElement),o.insertBefore(l,s.nextSibling);else{const d=t[t.length-1].node,g=d.nextSibling;d.parentElement.insertBefore(l,g)}t.push({key:u,tree:i,node:l})}u++}if(t.length>c.length){for(let i=c.length;i<t.length;i++){const f=t[i].tree;p(f.tag)&&ne(f.tag),t[i].node.remove(),p(f.tag)&&ee(f.tag)}t.splice(c.length,t.length-c.length)}r=!1})}function He({tag:e,attrs:n,children:t}){const r=R(e,n,t);return Ae(),O(Oe),r}function L(e){const n=new URL("http://0.0.0.0"+e),t=n.pathname,r=a.routes.find(o=>t.startsWith(o.path+"/")&&o.exact===!1);return{monitor:r?r.path:t,fullPath:n.href.replace(n.origin,""),path:t,query:Ie(n.search),hash:n.hash}}function X(e){if(I(e))return e;e=e;const n=e.path;let t="";for(const s in e.query)t+=`&${s}=${e.query[s]}`;t=t?"?"+t:"";const r=e.hash?"#"+e.hash:"";return n+t+r}function Ie(e){const n={};return e.replace("?","").split("&").forEach(r=>{const[o,s]=r.split("=");o&&s&&(n[o]=s)}),n}function le(){return a.mode==="history"?location.href.replace(location.origin+a.base,""):location.hash.slice(1)}function he(e){const{routes:n}=a,t=n.find(o=>o.path===e);if(t)return t;const r=n[n.length-1];if(r.path===void 0&&r.component)return r}function de(e){const n=X(e);a.mode==="history"?history.pushState({},"",a.base+n):location.hash=n,T(n)}function pe(e){const n=X(e);a.mode==="history"?history.replaceState({},"",a.base+n):location.hash=n,T(n)}function N(e){history.go(e)}function Be(){return{push:de,replace:pe,go:N}}const a={base:"",mode:"history",ssrDataKey:"g_initialProps",routes:[]};let m=null;function Ye(e={}){if(Object.assign(a,e),se()){const n=L(le());m=z(n)}else m??(m=L("/"));return{back:()=>N(-1),forward:()=>N(1),go:N,push:de,replace:pe,options:a,currentRoute:ce(m)}}function T(e){const n=L(e);for(const t in n)m[t]=n[t]}function Qe(){return m}function Fe(e){const n=[];e.children.forEach(o=>{o.tag==="title"?n.push(new RegExp("<title")):o.tag==="meta"&&o.attrs.name&&n.push(new RegExp(`<meta name=("|')?${o.attrs.name}`))});let t=[],r=0;return Ne(()=>{const o=document.head,s=o.innerHTML.split(`
`).filter(i=>i.includes("<")),c=[];e:for(let i=0;i<n.length;i++)for(let f=i;f<s.length;f++)if(n[i].test(s[f])){c.push(i);continue e}c.forEach(i=>{t.push(o.children[i].cloneNode(!0)),o.children[i].remove()}),r=e.children.length;const u=_(e.children);o.insertBefore(u,o.children[0])}),xe(Fe,()=>{const o=document.head;for(let s=0;s<r;s++)o.children[0].remove();t.forEach(s=>{o.insertBefore(s,o.childNodes[0])})}),y(F,null)}let Te,oe="/";function De(){let e="";if(a.mode==="history")e=oe.replace(a.base,"");else{const t=oe.match(/#.*/);e=t?t[0]:""}T(e);const n=he(m.monitor);return y(F,null,n&&y(n.component,{data:Te}))}function Ue(e){window.addEventListener("popstate",()=>{T(le())});const n=Ce(null);let t;return ke(()=>m.monitor,async r=>{const o=he(r);if(!o)return;const{getInitialProps:s}=o.component.prototype;if(typeof s=="function")if(window[a.ssrDataKey])t=window[a.ssrDataKey],delete window[a.ssrDataKey];else{n.value=e.loading;const c=ce(m);t=await s(c)}n.value=o.component},{immediate:!0}),y(F,null,()=>n.value&&y(n.value,{data:t}))}function Ge(e){return se()?y(Ue,{...e}):y(De,null)}const Ke={to:"/",type:"push"};function Je(e){e=H(Ke,e);const n=I(e.to)?e.to:X(e.to),t=a.base+(a.mode==="hash"?"#"+n:n),r=Be();function o(s){s.preventDefault(),e.type==="push"?r.push(n):r.replace(n)}return y("a",{className:e.className,href:t,onclick:o},e.children)}export{Fe as H,Je as L,Ge as R,Ye as a,He as b,ze as c,y as h,O as n,Ne as o,Ce as r,Qe as u,ke as w};
