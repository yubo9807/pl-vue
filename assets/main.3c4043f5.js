(()=>{"use strict";function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(t){return["object","array"].includes(e(t))}function n(e,t){if("object"==typeof e&&"object"==typeof t){const r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(const c of r){if(!o.includes(c))return!1;if(!n(e[c],t[c]))return!1}return!0}return e===t}let r=null;const o=new WeakMap;function c(e){r=e,e(),r=null}function i(e){const t=o.get(e);t&&t.forEach(((n,r)=>{const c=n();"boolean"==typeof c&&c&&(t.splice(r,1),o.set(e,t))}))}const l=new WeakMap,s={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function u(e){return!t(e)||l.get(e)?e:new Proxy(e,{get(e,n,c){if(n===s.RAW)return e;!function(e){const t=o.get(e)||[],n=t.some((e=>r===e));r&&!n&&t.push(r),o.set(e,t)}(e);const i=Reflect.get(e,n,c);return t(i)?u(i):i},set(e,t,n,r){const o=Reflect.get(e,t,r),c=Reflect.set(e,t,n,r);return e[s.IS_READONLY]?o:(c&&o!==n&&i(e),c)},deleteProperty(e,t){const n=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(e,t),r=Reflect.deleteProperty(e,t);return n&&r&&i(e),r}})}class a{__v_isRef=!0;__v_isShallow=!1;_rawValue;_value;constructor(e){this._rawValue=e,this._value=t(e)?u(e):u({value:e})}get value(){return t(this._rawValue)?this._value:this._value.value}set value(e){this._rawValue=e,t(e)?this._value=e:this._value.value=e}}function f(e,t,...n){return{tag:e,attrs:t||{},children:n}}function d({children:e}){return e}const p=Symbol("Fragment");function h(e){return"function"==typeof e&&e.prototype[p]===p}d.prototype[p]=p;const g=[];let y=!1;function m(){g.forEach((e=>{e()})),g.length=0,y=!0}function v(e){if(void 0!==typeof Promise)Promise.resolve().then(e);else if(void 0!==typeof MutationObserver){const t=new MutationObserver(e),n=document.createTextNode("0");t.observe(n,{characterData:!0}),n.data="1"}else void 0!==typeof process?process.nextTick(e):setTimeout(e,0)}function b(e){return["string","number"].includes(typeof e)&&""!==e}function _(e){return["className","innerHTML","innerText","textContent"].includes(e)}function j(t){return"object"===e(t)&&("string"==typeof t.tag||h(t.tag))}function w(e){return"function"==typeof e&&!h(e)}function O(t){return t instanceof Array?function(e){let t=new Array(e.length);for(let n=0;n<t.length;n++)t[n]=O(e[n]);return t}(t):"object"===e(t)?function(e){let t={},n=Object.getOwnPropertyNames(e);for(let r=0;r<n.length;r++)t[n[r]]=O(e[n[r]]);return t}(t):t}function C(t,n={},r=[]){if("function"==typeof t&&!h(t)){const e=t(O(Object.assign({},n,{children:r})));return C(e.tag,e.attrs,e.children)}const o=[];return r.forEach((t=>{if("object"===e(t)){const e=C(t.tag,t.attrs,t.children);o.push(e)}else o.push(t)})),{tag:t,attrs:n,children:o}}function E(e,t,n){if("string"==typeof e)return N(e,t,n);if(h(e))return S(n);if(w(e)){const r=e(Object.assign({},t,{children:n}));return E(r.tag,r.attrs,r.children)}}function N(t,n={},r=[""]){if(h(t))return E(t,n,r);const o=document.createElement(t);r.forEach((t=>{if(b(t)){const e=document.createTextNode(t);return e.nodeValue=t,void o.appendChild(e)}if("function"!=typeof t)if(t instanceof Array){const e=S(t);o.appendChild(e)}else if(j(t)){const e=N(t.tag,t.attrs,t.children);o.appendChild(e)}else if("object"===e(t)&&w(t.tag)){const e=x(t);o.appendChild(e)}else console.warn(`render: 不支持 ${t} 值渲染`);else{const e=S([t]);o.appendChild(e)}}));for(const e in n){const t=n[e];o[e]=t,"ref"===e&&(t.value=o),"function"==typeof t&&_(e)&&c((()=>{o[e]=t()}))}if(n.style&&n.style instanceof Object)for(const e in n.style){const t=n.style[e];"function"==typeof t?c((()=>o.style[e]=t())):o.style[e]=t}return o}function S(t){const r=document.createDocumentFragment();return t.forEach((t=>{if(b(t)){const e=document.createTextNode(t);return e.nodeValue=t,void r.appendChild(e)}if("function"==typeof t){let o=[],i=!0,l=null;const s=document.createTextNode("");return r.appendChild(s),void c((()=>{let c=t();if(e(c)&&h(c.tag))return void console.warn("不支持响应式节点片段渲染");c instanceof Array||(c=[c]);let u=0;for(;u<c.length;){const e=c[u];if(!e){u++;continue}const t=u,a=o.findIndex((e=>e.key===t));if(a>=0){if(n(e,o[a].tree)){u++;continue}const t=x(e);o[a].node.parentElement.replaceChild(t,o[a].node),o[a].tree=e,o[a].node=t}else{const n=x(e);if(i)r.appendChild(n);else if(0===o.length)l??=s.parentElement,l.insertBefore(n,s.nextSibling),s.remove();else{const e=o[o.length-1].node,t=e.nextSibling;e.parentElement.insertBefore(n,t)}o.push({key:t,tree:e,node:n})}u++}if(o.length>c.length)for(let e=c.length;e<o.length;e++)o[e].node.remove(),o.splice(e,1);i=!1}))}if(t instanceof Array){const e=S(t);r.appendChild(e)}else if(j(t)){const e=N(t.tag,t.attrs,t.children);r.appendChild(e)}else if("object"===e(t)&&w(t.tag)){const e=x(t);r.appendChild(e)}else console.warn(`render: 不支持 ${t} 值渲染`)})),r}function x(t){if(b(t))return document.createTextNode(t.toString());if(j(t))return E(t.tag,t.attrs,t.children);if("object"===e(t)&&w(t.tag)){const e=C(t.tag,t.attrs,t.children);return E(e.tag,e.attrs,e.children)}}function A(t,n={},r=[""]){if(h(t))return T(t(Object.assign({},n,{children:r})));if(w(t)){const e=t(Object.assign({},n,{children:r}));return A(e.tag,e.attrs,e.children)}let o="";for(const t in n){if(t.startsWith("on"))continue;let r="function"==typeof n[t]&&_(t)?n[t]():n[t];if("className"!==t){if("style"===t&&"object"===e(r)){for(const e in r)"function"==typeof r[e]&&(r[e]=r[e]());r='"'+JSON.stringify(r).slice(1,-1).replaceAll('"',"").replaceAll(",",";")+'"'}o+=` ${t}=${r}`}else o+=` class=${r}`}return`<${t}${o}>${T(r)}</${t}>`}function T(t){let n="";return t.forEach((t=>{if(b(t))n+=t.toString();else if(t instanceof Array)n+=T(t);else if("function"!=typeof t)e(t)?n+=A(t.tag,t.attrs,t.children):console.warn(`renderToString: 不支持 ${t} 值渲染`);else{const e=t();n+=T([e])}})),n}const R={demo:"demo__bac49"};function $(){const e=new a(1);return f(d,null,"父组件",f("h1",{className:R.demo},(()=>e.value)),f(k,{count:()=>e.value},f("p",null,"插槽1"),f("p",null,"插槽2")),f("button",{onclick:()=>e.value++},"click"))}function k(e){return f("div",null,f("p",null,"子组件"),f("p",null,"props: ",e.count),f("p",null,e.children))}console.log(function({tag:e,attrs:t,children:n}){return A(e,t,n)}(f($,null))),document.getElementById("root").appendChild(function({tag:e,attrs:t,children:n}){const r=E(e,t,n);if(r instanceof DocumentFragment){const e=r.children[0];v((()=>{e.parentNode&&m()}))}else r instanceof HTMLElement&&v((()=>{r.parentNode&&m()}));return r}(f($,null)))})();